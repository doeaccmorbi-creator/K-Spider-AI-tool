<!DOCTYPE html>
<html lang="en">
<head>
<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘   K Spider Image Master Pro v3.0                        â•‘
  â•‘   Brand   : K Spider AI Tools | www.kspiderai.in        â•‘
  â•‘   Devs    : Fatherâ€“Gaurang Raval & Sonâ€“Khush Raval       â•‘
  â•‘   Email   : kspider221206@gmail.com                     â•‘
  â•‘   YouTube : @KSpider4Kreaction                          â•‘
  â•‘   100% Client-Side Â· No Backend Â· No Server Storage     â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>K Spider Image Master Pro | Free Online Image Tool â€“ Convert Compress Passport Photo Resize Watermark</title>
<meta name="description" content="World-class free browser-based image tool. Convert JPG PNG WEBP, compress, passport photo generator, resize, crop, rotate, watermark, batch process. 100% private â€“ no server upload."/>
<meta name="keywords" content="free image tool,image converter,image compressor,passport photo generator,resize image,watermark tool,crop image,online image editor,jpg to png,k spider image tool"/>
<meta name="author" content="K Spider for Kreation"/>
<meta name="robots" content="index,follow"/>
<link rel="canonical" href="https://www.kspiderai.in"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="K Spider Image Master Pro | Free Browser-Based Image Tool"/>
<meta property="og:description" content="Convert, compress, resize, watermark, passport photo â€“ all in your browser. No upload. 100% private."/>
<meta property="og:url" content="https://www.kspiderai.in"/>
<meta property="og:site_name" content="K Spider AI Tools"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="K Spider Image Master Pro"/>
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"K Spider Image Master Pro","url":"https://www.kspiderai.in","description":"Free professional browser-based image processing tool","applicationCategory":"MultimediaApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"author":{"@type":"Organization","name":"K Spider for Kreation","url":"https://www.kspiderai.in"}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=DM+Sans:wght@400;500;600&family=Space+Mono&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css"/>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VARIABLES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --bg0:#07080c; --bg1:#0c0f18; --bg2:#111826; --bg3:#182030;
  --acc:#f5a623; --acc2:#00d9ff; --acc3:#25d366; --red:#ff4d4f; --green:#52c41a;
  --t0:#eef0f6; --t1:#8892a4; --t2:#525c72;
  --bdr:rgba(255,255,255,0.07); --bdr-a:rgba(245,166,35,0.35);
  --glow:rgba(245,166,35,0.14); --shadow:0 8px 40px rgba(0,0,0,.55);
  --sb:220px; --th:62px;
}
.lm{
  --bg0:#f0f2f6; --bg1:#fff; --bg2:#fff; --bg3:#f5f7fb;
  --t0:#181d2e; --t1:#4a5568; --t2:#9aa5b4;
  --bdr:rgba(0,0,0,.09); --bdr-a:rgba(245,166,35,.4); --glow:rgba(245,166,35,.1);
  --shadow:0 4px 24px rgba(0,0,0,.1);
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--bg0);color:var(--t0);min-height:100vh;overflow-x:hidden;transition:background .3s,color .3s}
button{font-family:'DM Sans',sans-serif;cursor:pointer}
input,select,textarea{font-family:'DM Sans',sans-serif}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:3px}
a{color:var(--acc);text-decoration:none}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#topbar{
  position:fixed;top:0;left:0;right:0;height:var(--th);
  background:var(--bg1);border-bottom:1px solid var(--bdr);
  display:flex;align-items:center;padding:0 16px;gap:8px;
  z-index:300;backdrop-filter:blur(14px);box-shadow:0 2px 16px rgba(0,0,0,.35)
}
.logo-box{
  width:40px;height:40px;background:linear-gradient(135deg,var(--acc),#c4821a);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  font-family:'Rajdhani',sans-serif;font-weight:700;font-size:20px;color:#000;
  box-shadow:0 2px 12px rgba(245,166,35,.45);flex-shrink:0
}
.brand-wrap{margin-right:14px;flex-shrink:0}
.brand-name{font-family:'Rajdhani',sans-serif;font-weight:700;font-size:15.5px;line-height:1.1}
.brand-name b{color:var(--acc)}
.brand-sub{font-size:9.5px;color:var(--t2)}
.tb{
  display:flex;align-items:center;gap:5px;padding:7px 13px;
  border-radius:8px;border:1px solid var(--bdr);background:var(--bg2);
  color:var(--t1);font-size:12.5px;white-space:nowrap;transition:all .18s
}
.tb:hover{border-color:var(--acc);color:var(--acc);background:var(--glow)}
.tb.acc{background:var(--acc);color:#000;border-color:var(--acc);font-weight:700}
.tb.acc:hover{background:#c4821a}
.tb.wa{background:var(--acc3);color:#fff;border-color:var(--acc3);font-weight:600}
.tb.wa:hover{opacity:.85}
.tb-gap{flex:1}
#themeBtn{width:36px;height:36px;border-radius:8px;border:1px solid var(--bdr);background:var(--bg2);color:var(--t1);font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s}
#themeBtn:hover{border-color:var(--acc);color:var(--acc)}
#menuBtn{display:none;width:36px;height:36px;border-radius:8px;border:1px solid var(--bdr);background:var(--bg2);color:var(--t1);font-size:20px;align-items:center;justify-content:center}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#wrap{display:flex;padding-top:var(--th);min-height:100vh}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#sb{
  width:var(--sb);flex-shrink:0;background:var(--bg1);border-right:1px solid var(--bdr);
  padding:14px 10px 100px;position:fixed;top:var(--th);left:0;bottom:0;
  overflow-y:auto;z-index:200;transition:transform .3s
}
.sl{font-size:9.5px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;color:var(--t2);padding:14px 12px 6px}
.ni{
  display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:9px;
  cursor:pointer;margin-bottom:2px;color:var(--t1);font-size:13.5px;font-weight:500;
  border:1px solid transparent;transition:all .18s;position:relative
}
.ni:hover{background:var(--bg3);color:var(--t0)}
.ni.on{background:var(--glow);color:var(--acc);border-color:var(--bdr-a)}
.ni.on::before{content:'';position:absolute;left:-10px;top:50%;transform:translateY(-50%);width:3px;height:60%;background:var(--acc);border-radius:0 3px 3px 0}
.ni-icon{font-size:16px;width:20px;text-align:center}
.ni-badge{margin-left:auto;background:var(--acc);color:#000;font-size:9px;font-weight:700;padding:2px 7px;border-radius:20px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#main{flex:1;margin-left:var(--sb);padding:22px 24px 80px;min-height:calc(100vh - var(--th))}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{background:var(--bg1);border:1px solid var(--bdr);border-radius:14px;padding:20px;margin-bottom:16px}
.card-title{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;margin-bottom:4px}
.card-title b{color:var(--acc)}
.card-sub{font-size:13px;color:var(--t1);margin-bottom:16px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• USER NAME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#unBanner{
  background:linear-gradient(135deg,rgba(245,166,35,.1),rgba(0,217,255,.05));
  border:1px solid var(--bdr-a);border-radius:12px;padding:14px 18px;
  display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:16px
}
.un-label{font-size:11px;color:var(--t2);margin-bottom:4px}
.un-row{display:flex;gap:8px;flex:1;min-width:200px}
#unInput{
  flex:1;padding:9px 13px;border-radius:8px;border:1px solid var(--bdr-a);
  background:var(--bg2);color:var(--t0);font-size:14px
}
#unInput:focus{outline:none;border-color:var(--acc)}
#unSavedMsg{font-size:12px;color:var(--green);display:none;margin-top:4px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DROP ZONE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#dropZone{
  border:2px dashed var(--bdr);border-radius:16px;padding:48px 24px;
  text-align:center;cursor:pointer;transition:all .25s;
  background:linear-gradient(160deg,var(--bg2),var(--bg1))
}
#dropZone:hover,#dropZone.over{border-color:var(--acc);background:var(--glow)}
.dz-icon{font-size:56px;margin-bottom:10px;line-height:1}
.dz-title{font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700;margin-bottom:6px}
.dz-sub{font-size:13.5px;color:var(--t1);margin-bottom:18px}
.dz-fmts{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-bottom:18px}
.fmt{padding:3px 11px;border-radius:20px;font-size:10.5px;font-weight:700;background:var(--bg2);border:1px solid var(--bdr);color:var(--t2);font-family:'Space Mono',monospace}
.dz-btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.dz-btn{padding:9px 22px;border-radius:8px;border:1px solid var(--bdr);background:var(--bg2);color:var(--t1);font-size:13px;transition:all .2s}
.dz-btn.p{background:var(--acc);color:#000;border-color:var(--acc);font-weight:700}
.dz-btn:hover{border-color:var(--acc);color:var(--acc)}
.dz-btn.p:hover{background:#c4821a}
.priv-note{margin-top:16px;font-size:11px;color:var(--t2);display:flex;align-items:center;justify-content:center;gap:6px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM ELEMENTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fl{display:block;font-size:12px;color:var(--t1);margin-bottom:5px;font-weight:500}
.fc{width:100%;padding:8px 11px;border-radius:8px;border:1px solid var(--bdr);background:var(--bg2);color:var(--t0);font-size:13px;transition:all .2s}
.fc:focus{outline:none;border-color:var(--acc);box-shadow:0 0 0 3px var(--glow)}
select.fc{cursor:pointer}
input[type=range]{width:100%;accent-color:var(--acc);cursor:pointer}
.rrow{display:flex;align-items:center;gap:10px}
.rv{min-width:44px;text-align:right;font-family:'Space Mono',monospace;font-size:12px;color:var(--acc);flex-shrink:0}
.crow{display:flex;align-items:center;gap:8px;margin-bottom:7px}
.crow input[type=checkbox]{accent-color:var(--acc);width:15px;height:15px}
.crow label{font-size:12.5px;color:var(--t1);cursor:pointer}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.fg{margin-bottom:12px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 18px;border-radius:9px;border:none;font-size:14px;font-weight:600;transition:all .2s;width:100%}
.btn-p{background:var(--acc);color:#000}
.btn-p:hover{background:#c4821a;transform:translateY(-1px);box-shadow:0 4px 16px rgba(245,166,35,.35)}
.btn-s{background:transparent;color:var(--t1);border:1px solid var(--bdr)}
.btn-s:hover{border-color:var(--acc);color:var(--acc);background:var(--glow)}
.btn-wa{background:var(--acc3);color:#fff}
.btn-wa:hover{background:#1db954;transform:translateY(-1px)}
.btn-info{background:var(--acc2);color:#000;font-weight:700}
.btn-info:hover{opacity:.88}
.btn-red{background:var(--red);color:#fff}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAG PILLS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.tag{padding:5px 13px;border-radius:20px;font-size:12px;font-weight:600;border:1px solid var(--bdr);color:var(--t1);cursor:pointer;transition:all .18s;user-select:none}
.tag:hover,.tag.on{background:var(--glow);border-color:var(--bdr-a);color:var(--acc)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs{display:flex;gap:3px;background:var(--bg2);padding:4px;border-radius:10px;border:1px solid var(--bdr);margin-bottom:14px}
.tabBtn{flex:1;padding:8px 6px;border-radius:7px;border:none;background:none;color:var(--t2);font-size:12.5px;transition:all .2s;font-weight:500}
.tabBtn.on{background:var(--acc);color:#000;font-weight:700}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION TITLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stitle{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t2);margin-bottom:8px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PREVIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#previewArea{display:none}
.pv-header{display:flex;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap}
.pv-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;flex:1}
.infobar{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:11px 16px;display:flex;gap:18px;flex-wrap:wrap;margin-bottom:14px}
.ib{font-size:11.5px}
.ib-l{color:var(--t2);margin-bottom:2px}
.ib-v{font-weight:700;font-family:'Space Mono',monospace;font-size:12px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CANVAS WRAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cv-wrap{
  background:var(--bg2);border:1px solid var(--bdr);border-radius:12px;
  padding:16px;display:flex;justify-content:center;align-items:center;
  min-height:260px;overflow:hidden;position:relative
}
#mainCanvas{max-width:100%;max-height:400px;border-radius:6px;display:block}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BEFORE/AFTER SLIDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ba-wrap{position:relative;overflow:hidden;border-radius:10px;cursor:ew-resize;user-select:none}
.ba-after{position:absolute;inset:0;overflow:hidden}
.ba-divider{position:absolute;top:0;bottom:0;width:3px;background:var(--acc);z-index:10;cursor:ew-resize}
.ba-handle{position:absolute;top:50%;transform:translate(-50%,-50%);width:36px;height:36px;background:var(--acc);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-size:18px;font-weight:700;z-index:11}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• OUTPUT BOX â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.outbox{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:12px 16px;margin-bottom:12px}
.out-row{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.out-stat{font-size:12px;color:var(--t1)}
.out-stat strong{color:var(--t0);font-family:'Space Mono',monospace}
.sz-tag{font-size:11.5px;font-weight:700;padding:3px 10px;border-radius:20px}
.sz-down{background:rgba(82,196,26,.15);color:var(--green)}
.sz-up{background:rgba(255,77,79,.15);color:var(--red)}
.progress{height:4px;background:var(--bg3);border-radius:2px;margin:10px 0;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--acc),var(--acc2));border-radius:2px;transition:width .3s;width:0}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ACTION ROW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.act-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
.act-row .btn{flex:1;min-width:110px;padding:9px 10px;font-size:13px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ALERT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.alert{padding:10px 14px;border-radius:9px;font-size:13px;margin-bottom:12px;display:none}
.alert.show{display:block}
.alert-ok{background:rgba(82,196,26,.1);border:1px solid var(--green);color:var(--green)}
.alert-err{background:rgba(255,77,79,.1);border:1px solid var(--red);color:var(--red)}
.alert-info{background:rgba(0,217,255,.09);border:1px solid var(--acc2);color:var(--acc2)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI BOX â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ai-box{background:linear-gradient(135deg,rgba(245,166,35,.08),rgba(0,217,255,.04));border:1px solid var(--bdr-a);border-radius:10px;padding:13px 16px;margin-bottom:14px}
.ai-title{font-size:12px;font-weight:700;color:var(--acc);margin-bottom:7px;display:flex;align-items:center;gap:6px}
.ai-tip{font-size:12px;color:var(--t1);margin-bottom:4px;padding-left:14px;position:relative}
.ai-tip::before{content:'â–¸';position:absolute;left:0;color:var(--acc)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOOL SECTIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tool-sec{display:none}
.tool-sec.on{display:block}
.tool-sec .card{margin-bottom:0}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOOLS GRID (INLINE) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tools-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
@media(max-width:500px){.tools-grid{grid-template-columns:1fr}}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WM POSITION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wmgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;margin-bottom:10px}
.wmcell{padding:8px 4px;border-radius:7px;border:1px solid var(--bdr);background:var(--bg2);color:var(--t2);font-size:10.5px;cursor:pointer;text-align:center;transition:all .18s}
.wmcell:hover,.wmcell.on{border-color:var(--acc);color:var(--acc);background:var(--glow)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:500;align-items:center;justify-content:center;padding:16px}
.modal.open{display:flex}
.modal-box{background:var(--bg2);border:1px solid var(--bdr);border-radius:16px;padding:24px;width:100%;max-width:460px;box-shadow:var(--shadow);animation:fi .22s ease}
.modal-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center}
.mcl{background:none;border:none;color:var(--t1);font-size:22px;cursor:pointer;line-height:1}
.mcl:hover{color:var(--red)}
.q-opts{display:flex;gap:6px;margin-bottom:12px}
.qo{flex:1;padding:9px 6px;text-align:center;border-radius:8px;border:1px solid var(--bdr);cursor:pointer;font-size:12.5px;background:var(--bg2);color:var(--t1);transition:all .18s}
.qo.on{border-color:var(--acc);background:var(--glow);color:var(--acc);font-weight:700}
.dl-est{background:var(--bg1);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--t1);text-align:center;margin:10px 0}
.dl-est strong{color:var(--acc);font-family:'Space Mono',monospace}
.wa-msg{background:rgba(37,211,102,.08);border:1px solid rgba(37,211,102,.25);border-radius:10px;padding:12px 14px;font-size:12.5px;color:var(--t1);margin:10px 0;line-height:1.65;white-space:pre-wrap}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PASSPORT PREVIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#passportOut{display:none;margin-top:14px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CROP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#cropArea{display:none;margin-top:14px}
#cropImgEl{max-width:100%}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BATCH LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bi{display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--bg2);border:1px solid var(--bdr);border-radius:8px;margin-bottom:6px;font-size:12.5px}
.bi img{width:38px;height:38px;object-fit:cover;border-radius:6px;flex-shrink:0}
.bi-name{flex:1;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.bi-sz{color:var(--t2);font-size:11px;font-family:'Space Mono',monospace;flex-shrink:0}
.bi-st{font-size:11px;font-weight:700;flex-shrink:0}
.ok{color:var(--green)} .pend{color:var(--t2)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COLLAPSIBLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.col-sec{border:1px solid var(--bdr);border-radius:10px;margin-bottom:8px;overflow:hidden}
.col-hdr{padding:13px 16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:600;font-size:13.5px;background:var(--bg2);transition:background .2s}
.col-hdr:hover{background:var(--bg3)}
.col-arr{transition:transform .3s;font-size:11px}
.col-body{padding:0 16px;max-height:0;overflow:hidden;transition:max-height .38s ease,padding .28s;background:var(--bg1);font-size:13px;color:var(--t1);line-height:1.75}
.col-body.open{max-height:600px;padding:14px 16px}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RATING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stars{display:flex;gap:4px;font-size:28px;cursor:pointer;justify-content:center;margin:10px 0}
.star{color:var(--t2);transition:color .15s}
.star.lit{color:var(--acc)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SOCIAL SHARE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.share-row{display:flex;gap:8px;flex-wrap:wrap}
.sh-btn{flex:1;min-width:80px;padding:9px 8px;border-radius:9px;border:none;color:#fff;font-size:12.5px;font-weight:600;cursor:pointer;transition:all .18s}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MONETIZE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mon-card{border-radius:12px;padding:16px;margin-bottom:12px;text-align:center}
.yt-card{background:linear-gradient(135deg,rgba(255,0,0,.12),rgba(255,0,0,.04));border:1px solid rgba(255,0,0,.2)}
.upi-card{background:linear-gradient(135deg,rgba(245,166,35,.1),rgba(0,217,255,.06));border:1px solid var(--bdr-a)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#footer{background:var(--bg1);border-top:1px solid var(--bdr);padding:14px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:gap;gap:8px;font-size:11.5px;color:var(--t2)}
.footer-brand{font-weight:600;color:var(--t1)}
.footer-brand b{color:var(--acc)}
.footer-links{display:flex;gap:14px;flex-wrap:wrap}
.footer-links a{color:var(--t2);transition:color .2s}
.footer-links a:hover{color:var(--acc)}
.powered{width:100%;text-align:center;font-size:10.5px;color:var(--t2);padding-top:8px;border-top:1px solid var(--bdr);margin-top:6px}
.powered a{color:var(--acc)}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ANIMATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fi .28s ease}
@keyframes spin{to{transform:rotate(360deg)}}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:900px){
  #sb{transform:translateX(-100%)}
  #sb.open{transform:translateX(0)}
  #main{margin-left:0;padding:16px 14px 80px}
  #menuBtn{display:flex !important}
  .tb span{display:none}
}
@media(max-width:600px){
  .g2,.g3{grid-template-columns:1fr}
  .tools-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CAMERA MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="camModal" class="modal">
  <div class="modal-box">
    <div class="modal-title">ğŸ“· Camera Capture <button class="mcl" onclick="closeModal('camModal')">âœ•</button></div>
    <video id="camVid" autoplay playsinline style="width:100%;border-radius:10px"></video>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn btn-p" onclick="capturePhoto()" style="flex:1">ğŸ“¸ Capture</button>
      <button class="btn btn-s" onclick="closeModal('camModal')" style="flex:1">Cancel</button>
    </div>
    <canvas id="capCanvas" style="display:none"></canvas>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DOWNLOAD MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="dlModal" class="modal">
  <div class="modal-box">
    <div class="modal-title">â¬‡ Download <button class="mcl" onclick="closeModal('dlModal')">âœ•</button></div>
    <div class="stitle">Output Format</div>
    <div class="tags" id="dlFmtTags" style="margin-bottom:14px">
      <span class="tag on" onclick="setTag(this,'dlFmtTags');calcDlEst()">JPG</span>
      <span class="tag" onclick="setTag(this,'dlFmtTags');calcDlEst()">PNG</span>
      <span class="tag" onclick="setTag(this,'dlFmtTags');calcDlEst()">WEBP</span>
      <span class="tag" onclick="setTag(this,'dlFmtTags');calcDlEst()">PDF</span>
    </div>
    <div class="stitle">Quality</div>
    <div class="q-opts" style="margin-bottom:14px">
      <div class="qo" onclick="setQuality(this,0.95)">â­ High<br><small>95%</small></div>
      <div class="qo on" onclick="setQuality(this,0.82)">âš¡ Medium<br><small>82%</small></div>
      <div class="qo" onclick="setQuality(this,0.55)">ğŸ“¦ Small<br><small>55%</small></div>
    </div>
    <div class="stitle">File Name</div>
    <input type="text" class="fc" id="dlName" value="kspider_output" style="margin-bottom:10px" oninput="calcDlEst()"/>
    <div class="dl-est">Estimated size: <strong id="dlEst">â€”</strong></div>
    <div style="background:rgba(245,166,35,.07);border-radius:8px;padding:8px 12px;font-size:11px;color:var(--t2);margin-bottom:14px;text-align:center">ğŸ”’ Powered by K Spider AI Tool â€” www.kspiderai.in</div>
    <button class="btn btn-p" onclick="execDownload()">â¬‡ Download Now</button>
    <button class="btn btn-s" onclick="closeModal('dlModal')" style="margin-top:7px">Cancel</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• WHATSAPP MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="waModal" class="modal">
  <div class="modal-box">
    <div class="modal-title">ğŸ’¬ Share via WhatsApp <button class="mcl" onclick="closeModal('waModal')">âœ•</button></div>
    <div class="fg">
      <label class="fl">Country Code + Phone Number</label>
      <div style="display:flex;gap:8px">
        <select class="fc" id="waCc" style="width:120px;flex-shrink:0" onchange="buildWaMsg()">
          <option value="91">ğŸ‡®ğŸ‡³ +91</option>
          <option value="1">ğŸ‡ºğŸ‡¸ +1</option>
          <option value="44">ğŸ‡¬ğŸ‡§ +44</option>
          <option value="61">ğŸ‡¦ğŸ‡º +61</option>
          <option value="971">ğŸ‡¦ğŸ‡ª +971</option>
          <option value="65">ğŸ‡¸ğŸ‡¬ +65</option>
          <option value="60">ğŸ‡²ğŸ‡¾ +60</option>
          <option value="92">ğŸ‡µğŸ‡° +92</option>
          <option value="880">ğŸ‡§ğŸ‡© +880</option>
          <option value="33">ğŸ‡«ğŸ‡· +33</option>
          <option value="49">ğŸ‡©ğŸ‡ª +49</option>
          <option value="34">ğŸ‡ªğŸ‡¸ +34</option>
          <option value="55">ğŸ‡§ğŸ‡· +55</option>
        </select>
        <input type="tel" class="fc" id="waPhone" placeholder="9876543210" oninput="buildWaMsg()" style="flex:1"/>
      </div>
    </div>
    <div class="fg">
      <label class="fl">Your Name (auto-filled)</label>
      <input type="text" class="fc" id="waName" placeholder="Your full name" oninput="buildWaMsg()"/>
    </div>
    <div class="stitle">Message Preview</div>
    <div class="wa-msg" id="waPreview"></div>
    <button class="btn btn-wa" onclick="openWhatsApp()">ğŸ’¬ Open WhatsApp (No Contact Save)</button>
    <button class="btn btn-s" onclick="closeModal('waModal')" style="margin-top:7px">Cancel</button>
    <p style="text-align:center;font-size:11px;color:var(--t2);margin-top:10px">â„¹ Opens WhatsApp directly. No number saved to contacts.</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header id="topbar">
  <button id="menuBtn" onclick="toggleSidebar()" style="display:none">â˜°</button>
  <div style="display:flex;align-items:center;gap:10px;text-decoration:none">
    <div class="logo-box">KS</div>
    <div class="brand-wrap">
      <div class="brand-name">K Spider <b>Image Master Pro</b></div>
      <div class="brand-sub">by K Spider for Kreation â€¢ v3.0</div>
    </div>
  </div>
  <button class="tb" onclick="document.getElementById('fileIn').click()">ğŸ“ <span>Upload</span></button>
  <button class="tb" onclick="document.getElementById('multiIn').click()">ğŸ—‚ <span>Multi</span></button>
  <button class="tb" onclick="openCamera()">ğŸ“· <span>Camera</span></button>
  <button class="tb" onclick="pasteUrl()">ğŸ”— <span>URL</span></button>
  <button class="tb acc" id="dlBtn" onclick="openDlModal()" style="display:none">â¬‡ <span>Download</span></button>
  <button class="tb wa" id="waBtn" onclick="openWaModal()" style="display:none">ğŸ’¬ <span>Share</span></button>
  <button class="tb" id="resetBtn" onclick="resetAll()" style="display:none">â†º <span>Reset</span></button>
  <div class="tb-gap"></div>
  <button id="themeBtn" onclick="toggleTheme()" title="Toggle theme">ğŸŒ™</button>
</header>

<div id="wrap">
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="sb">
  <div class="sl">Image Tools</div>
  <div class="ni on" id="nav-home" onclick="go('home')"><span class="ni-icon">ğŸ </span>Home</div>
  <div class="ni" id="nav-convert" onclick="go('convert')"><span class="ni-icon">ğŸ”„</span>Convert</div>
  <div class="ni" id="nav-compress" onclick="go('compress')"><span class="ni-icon">ğŸ“¦</span>Compress</div>
  <div class="ni" id="nav-passport" onclick="go('passport')"><span class="ni-icon">ğŸªª</span>Passport Photo<span class="ni-badge">Pro</span></div>
  <div class="ni" id="nav-resize" onclick="go('resize')"><span class="ni-icon">â†”ï¸</span>Resize</div>
  <div class="ni" id="nav-crop" onclick="go('crop')"><span class="ni-icon">âœ‚ï¸</span>Crop</div>
  <div class="ni" id="nav-rotate" onclick="go('rotate')"><span class="ni-icon">ğŸ”ƒ</span>Rotate & Flip</div>
  <div class="ni" id="nav-background" onclick="go('background')"><span class="ni-icon">ğŸ¨</span>Background</div>
  <div class="ni" id="nav-watermark" onclick="go('watermark')"><span class="ni-icon">ğŸ’§</span>Watermark</div>
  <div class="ni" id="nav-batch" onclick="go('batch')"><span class="ni-icon">ğŸ—‚</span>Batch Process</div>
  <div class="sl">Info</div>
  <div class="ni" id="nav-monetize" onclick="go('monetize')"><span class="ni-icon">ğŸ’°</span>Support Us</div>
  <div class="ni" id="nav-legal" onclick="go('legal')"><span class="ni-icon">ğŸ“‹</span>Legal & Policy</div>
  <div class="ni" id="nav-about" onclick="go('about')"><span class="ni-icon">â„¹ï¸</span>About</div>
  <div style="margin-top:18px;padding:12px;background:var(--bg2);border-radius:10px;border:1px solid var(--bdr)">
    <div style="font-size:10px;color:var(--t2);margin-bottom:4px">ğŸŒ Website</div>
    <a href="https://www.kspiderai.in" target="_blank" style="font-size:12px;font-weight:700;color:var(--acc)">www.kspiderai.in</a>
    <div style="margin-top:8px;font-size:10px;color:var(--t2)">ğŸ¬ YouTube</div>
    <a href="https://www.youtube.com/@KSpider4Kreaction" target="_blank" style="font-size:11px;color:var(--acc2)">@KSpider4Kreaction</a>
    <div style="margin-top:8px;font-size:10px;color:var(--t2)">ğŸ“§ Email</div>
    <a href="mailto:kspider221206@gmail.com" style="font-size:11px;color:var(--t1)">kspider221206@gmail.com</a>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN CONTENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main id="main">
<input type="file" id="fileIn" accept="image/*" style="display:none" onchange="loadFile(event.target.files[0]);this.value=''"/>
<input type="file" id="multiIn" accept="image/*" multiple style="display:none" onchange="loadBatch(event.target.files);this.value=''"/>

<!-- USER NAME BANNER -->
<div id="unBanner">
  <div style="font-size:28px">ğŸ‘¤</div>
  <div style="flex:1">
    <div class="un-label">Your Name (used in outputs & WhatsApp messages)</div>
    <div class="un-row">
      <input type="text" id="unInput" placeholder="Enter your full name..." oninput="S.userName=sanitize(this.value);buildWaMsg()"/>
      <button class="btn btn-p" onclick="saveName()" style="width:auto;padding:9px 16px;font-size:12.5px">Save</button>
    </div>
    <div id="unSavedMsg">âœ… Name saved!</div>
  </div>
</div>

<!-- ALERT -->
<div id="alert" class="alert"></div>

<!-- â•â•â• DROP ZONE â•â•â• -->
<div id="dropZone" onclick="document.getElementById('fileIn').click()"
  ondragover="event.preventDefault();this.classList.add('over')"
  ondrop="this.classList.remove('over');event.preventDefault();handleDrop(event)"
  ondragleave="this.classList.remove('over')">
  <div class="dz-icon">ğŸ•·ï¸</div>
  <div class="dz-title">Drop Your Image Here</div>
  <div class="dz-sub">Drag & drop, paste URL, use camera, or browse files â€” 100% private</div>
  <div class="dz-fmts">
    <span class="fmt">JPG</span><span class="fmt">PNG</span><span class="fmt">WEBP</span>
    <span class="fmt">GIF</span><span class="fmt">BMP</span><span class="fmt">SVG</span>
  </div>
  <div class="dz-btns">
    <button class="dz-btn p" onclick="event.stopPropagation();document.getElementById('fileIn').click()">ğŸ“ Browse Files</button>
    <button class="dz-btn" onclick="event.stopPropagation();document.getElementById('multiIn').click()">ğŸ—‚ Multi Upload</button>
    <button class="dz-btn" onclick="event.stopPropagation();openCamera()">ğŸ“· Camera</button>
    <button class="dz-btn" onclick="event.stopPropagation();pasteUrl()">ğŸ”— From URL</button>
  </div>
  <div class="priv-note">ğŸ”’ All processing is 100% in your browser. No image is ever uploaded to any server.</div>
</div>

<!-- â•â•â• PREVIEW AREA â•â•â• -->
<div id="previewArea" class="fade-in">
  <div class="pv-header">
    <div class="pv-title">ğŸ“¸ Image Preview</div>
    <button class="tb" onclick="resetAll()">â†º New Image</button>
  </div>

  <div class="infobar" id="infobar">
    <div class="ib"><div class="ib-l">Name</div><div class="ib-v" id="iName">â€”</div></div>
    <div class="ib"><div class="ib-l">Size</div><div class="ib-v" id="iSize">â€”</div></div>
    <div class="ib"><div class="ib-l">Dimensions</div><div class="ib-v" id="iDims">â€”</div></div>
    <div class="ib"><div class="ib-l">Format</div><div class="ib-v" id="iFmt">â€”</div></div>
  </div>

  <div id="aiBox" class="ai-box" style="display:none">
    <div class="ai-title">ğŸ¤– AI Smart Suggestions</div>
    <div id="aiTips"></div>
  </div>

  <div class="cv-wrap" id="cvWrap">
    <canvas id="mainCanvas"></canvas>
  </div>

  <div id="outBox" class="outbox" style="display:none;margin-top:12px">
    <div class="out-row">
      <div class="out-stat">Original: <strong id="origSz">â€”</strong></div>
      <div class="out-stat">Output: <strong id="newSz">â€”</strong></div>
      <div class="out-stat">Size: <strong id="newDims">â€”</strong></div>
      <span id="szTag" class="sz-tag"></span>
    </div>
    <div class="progress" id="pgBar" style="display:none"><div class="progress-fill" id="pgFill"></div></div>
  </div>

  <div id="actRow" class="act-row" style="display:none">
    <button class="btn btn-p" onclick="openDlModal()">â¬‡ Download</button>
    <button class="btn btn-wa" onclick="openWaModal()">ğŸ’¬ WhatsApp</button>
    <button class="btn btn-s" onclick="regen()">ğŸ”„ Regenerate</button>
    <button class="btn btn-s" onclick="editAgain()">âœï¸ Edit Again</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOOL SECTIONS â€” ALL INLINE IN MAIN AREA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <!-- HOME -->
  <div id="sec-home" class="tool-sec on">
    <div class="card" style="text-align:center;padding:30px">
      <div style="font-size:52px;margin-bottom:12px">ğŸ•·ï¸</div>
      <div class="card-title" style="font-size:26px;justify-content:center">K Spider <b>Image Master Pro</b></div>
      <div class="card-sub">Upload an image above to get started. All tools work 100% in your browser.</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:16px">
        <div onclick="go('convert')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸ”„</div><div style="font-size:13px;font-weight:600;margin-top:6px">Convert</div>
        </div>
        <div onclick="go('compress')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸ“¦</div><div style="font-size:13px;font-weight:600;margin-top:6px">Compress</div>
        </div>
        <div onclick="go('passport')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸªª</div><div style="font-size:13px;font-weight:600;margin-top:6px">Passport Photo</div>
        </div>
        <div onclick="go('resize')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">â†”ï¸</div><div style="font-size:13px;font-weight:600;margin-top:6px">Resize</div>
        </div>
        <div onclick="go('crop')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">âœ‚ï¸</div><div style="font-size:13px;font-weight:600;margin-top:6px">Crop</div>
        </div>
        <div onclick="go('rotate')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸ”ƒ</div><div style="font-size:13px;font-weight:600;margin-top:6px">Rotate & Flip</div>
        </div>
        <div onclick="go('watermark')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸ’§</div><div style="font-size:13px;font-weight:600;margin-top:6px">Watermark</div>
        </div>
        <div onclick="go('batch')" style="background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--acc)'" onmouseout="this.style.borderColor='var(--bdr)'">
          <div style="font-size:28px">ğŸ—‚</div><div style="font-size:13px;font-weight:600;margin-top:6px">Batch Process</div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONVERT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-convert" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ”„ Image <b>Converter</b></div>
      <div class="card-sub">Convert between JPG, PNG, WEBP. Change color mode and DPI.</div>
      <div class="g2">
        <div class="fg">
          <label class="fl">Output Format</label>
          <div class="tags" id="cvFmt">
            <span class="tag on" onclick="setTag(this,'cvFmt')">JPG</span>
            <span class="tag" onclick="setTag(this,'cvFmt')">PNG</span>
            <span class="tag" onclick="setTag(this,'cvFmt')">WEBP</span>
            <span class="tag" onclick="setTag(this,'cvFmt')">PDF</span>
            <span class="tag" onclick="setTag(this,'cvFmt')">ICO</span>
          </div>
        </div>
        <div class="fg">
          <label class="fl">Color Mode</label>
          <select class="fc" id="cvColor">
            <option>RGB (Original)</option>
            <option>Grayscale</option>
            <option>Sepia Tone</option>
            <option>Invert Colors</option>
          </select>
        </div>
        <div class="fg">
          <label class="fl">Quality: <span id="cvQV" style="color:var(--acc)">90%</span></label>
          <input type="range" min="10" max="100" value="90" oninput="document.getElementById('cvQV').textContent=this.value+'%'" id="cvQ"/>
        </div>
        <div class="fg">
          <label class="fl">DPI (Metadata Hint)</label>
          <div class="tags" id="cvDPI">
            <span class="tag on" onclick="setTag(this,'cvDPI')">72</span>
            <span class="tag" onclick="setTag(this,'cvDPI')">150</span>
            <span class="tag" onclick="setTag(this,'cvDPI')">300</span>
            <span class="tag" onclick="setTag(this,'cvDPI')">600</span>
          </div>
        </div>
      </div>
      <div class="crow"><input type="checkbox" id="cvBrand"/><label for="cvBrand">Add K Spider branding watermark</label></div>
      <button class="btn btn-p" onclick="doConvert()">ğŸ”„ Convert Image Now</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ COMPRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-compress" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ“¦ Image <b>Compressor</b></div>
      <div class="card-sub">Reduce file size. Choose manual quality, target KB, or AI smart mode.</div>
      <div class="tabs">
        <button class="tabBtn on" onclick="setTab(this,'cmpTabs');showEl('cmpManual');hideEl('cmpTarget');hideEl('cmpSmart')">Manual</button>
        <button class="tabBtn" onclick="setTab(this,'cmpTabs');hideEl('cmpManual');showEl('cmpTarget');hideEl('cmpSmart')">Target Size</button>
        <button class="tabBtn" onclick="setTab(this,'cmpTabs');hideEl('cmpManual');hideEl('cmpTarget');showEl('cmpSmart')">ğŸ¤– AI Smart</button>
      </div>
      <div id="cmpManual">
        <label class="fl">Quality: <span id="cmpQV" style="color:var(--acc)">80%</span></label>
        <input type="range" min="5" max="100" value="80" id="cmpQ" oninput="document.getElementById('cmpQV').textContent=this.value+'%'" style="margin-bottom:12px"/>
      </div>
      <div id="cmpTarget" style="display:none">
        <label class="fl">Target File Size (KB)</label>
        <input type="number" class="fc" id="cmpTargKB" value="100" min="10" max="9999" style="margin-bottom:12px"/>
        <p style="font-size:11.5px;color:var(--t2);margin-bottom:12px">Tool will auto-find quality to match target size.</p>
      </div>
      <div id="cmpSmart" style="display:none">
        <div class="ai-box" style="margin-bottom:12px">
          <div class="ai-title">ğŸ¤– AI Smart Compression</div>
          <div class="ai-tip">Analyzes image dimensions and current file size</div>
          <div class="ai-tip">Auto-selects optimal quality setting</div>
          <div class="ai-tip">Best balance of quality vs file size</div>
        </div>
      </div>
      <div class="crow"><input type="checkbox" id="cmpBrand"/><label for="cmpBrand">Add K Spider branding</label></div>
      <button class="btn btn-p" onclick="doCompress()">ğŸ“¦ Compress Now</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PASSPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-passport" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸªª Passport <b>Photo Generator</b></div>
      <div class="card-sub">Generate print-ready passport, visa, Aadhaar, PAN ID photos on A4/A3/Letter/Custom paper.</div>
      <div class="g2">
        <!-- Photo Size -->
        <div class="fg">
          <label class="fl">Photo Size Template</label>
          <select class="fc" id="ppTmpl" onchange="ppTmplChange()">
            <optgroup label="Standard Sizes">
              <option value="35x45">India Passport (35Ã—45 mm)</option>
              <option value="50x50">US Visa / 2Ã—2 inch (50Ã—50 mm)</option>
              <option value="35x45c">Canada / UK Visa (35Ã—45 mm)</option>
              <option value="25x35">Aadhaar Card (25Ã—35 mm)</option>
              <option value="35x35">PAN Card (35Ã—35 mm)</option>
              <option value="35x45d">Driving License (35Ã—45 mm)</option>
              <option value="45x35">Job Form Standard (45Ã—35 mm)</option>
              <option value="40x60">China Visa (40Ã—60 mm)</option>
            </optgroup>
            <optgroup label="Custom">
              <option value="custom">Custom Size (enter below)</option>
            </optgroup>
          </select>
          <div id="ppCustomSize" style="display:none;margin-top:8px">
            <div class="g2">
              <div><label class="fl">Width (mm)</label><input type="number" class="fc" id="ppCW" value="35"/></div>
              <div><label class="fl">Height (mm)</label><input type="number" class="fc" id="ppCH" value="45"/></div>
            </div>
          </div>
        </div>
        <!-- Paper Size -->
        <div class="fg">
          <label class="fl">Paper Size</label>
          <div class="tags" id="ppPaper" style="margin-bottom:8px">
            <span class="tag on" onclick="setTag(this,'ppPaper')">A4</span>
            <span class="tag" onclick="setTag(this,'ppPaper')">A3</span>
            <span class="tag" onclick="setTag(this,'ppPaper')">Letter</span>
            <span class="tag" onclick="setTag(this,'ppPaper')">Custom</span>
          </div>
          <div id="ppCustomPaper" style="display:none">
            <div class="g2">
              <div><label class="fl">Width (mm)</label><input type="number" class="fc" id="ppPW" value="210"/></div>
              <div><label class="fl">Height (mm)</label><input type="number" class="fc" id="ppPH" value="297"/></div>
            </div>
          </div>
        </div>
        <!-- Number of Copies -->
        <div class="fg">
          <label class="fl">Number of Copies on Page</label>
          <div class="tags" id="ppCopies">
            <span class="tag" onclick="setTag(this,'ppCopies')">2</span>
            <span class="tag" onclick="setTag(this,'ppCopies')">4</span>
            <span class="tag on" onclick="setTag(this,'ppCopies')">8</span>
            <span class="tag" onclick="setTag(this,'ppCopies')">12</span>
            <span class="tag" onclick="setTag(this,'ppCopies')">16</span>
            <span class="tag" onclick="setTag(this,'ppCopies')">24</span>
          </div>
        </div>
        <!-- Background -->
        <div class="fg">
          <label class="fl">Photo Background</label>
          <div class="tags" id="ppBg">
            <span class="tag on" onclick="setTag(this,'ppBg')">White</span>
            <span class="tag" onclick="setTag(this,'ppBg')">Light Blue</span>
            <span class="tag" onclick="setTag(this,'ppBg')">Off White</span>
            <span class="tag" onclick="setTag(this,'ppBg')">Custom</span>
          </div>
          <input type="color" class="fc" id="ppBgCustom" value="#ffffff" style="margin-top:8px;height:38px"/>
        </div>
        <!-- Margin -->
        <div class="fg">
          <label class="fl">Spacing between photos: <span id="ppMarV" style="color:var(--acc)">12px</span></label>
          <input type="range" min="4" max="60" value="12" id="ppMar" oninput="document.getElementById('ppMarV').textContent=this.value+'px'"/>
        </div>
        <!-- Orientation -->
        <div class="fg">
          <label class="fl">Page Orientation</label>
          <div class="tags" id="ppOrient">
            <span class="tag on" onclick="setTag(this,'ppOrient')">Portrait</span>
            <span class="tag" onclick="setTag(this,'ppOrient')">Landscape</span>
          </div>
        </div>
      </div>
      <div class="crow" style="margin-bottom:10px"><input type="checkbox" id="ppBrand" checked/><label for="ppBrand">Add K Spider branding line</label></div>
      <div class="crow" style="margin-bottom:14px"><input type="checkbox" id="ppGuide"/><label for="ppGuide">Show cut guide lines</label></div>
      <button class="btn btn-p" onclick="doPassport()">ğŸªª Generate Passport Photos</button>
    </div>
    <div id="passportOut">
      <div class="card">
        <div class="stitle">ğŸ“„ Print Layout Preview</div>
        <div style="background:#fff;border-radius:8px;padding:10px;display:inline-block;max-width:100%">
          <canvas id="ppCanvas" style="max-width:100%;border-radius:4px;display:block"></canvas>
        </div>
        <div class="act-row" style="margin-top:12px">
          <button class="btn btn-p" onclick="dlPassport('jpg')" style="flex:1">â¬‡ Download JPG</button>
          <button class="btn btn-info" onclick="dlPassport('pdf')" style="flex:1">ğŸ“„ Export PDF</button>
          <button class="btn btn-s" onclick="doPassport()" style="flex:1">ğŸ”„ Regenerate</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-resize" class="tool-sec">
    <div class="card">
      <div class="card-title">â†”ï¸ Image <b>Resizer</b></div>
      <div class="card-sub">Resize by custom dimensions, percentage, or social media presets.</div>
      <div class="tabs">
        <button class="tabBtn on" onclick="setTab(this,'rzTabs');showEl('rzCustom');hideEl('rzPct');hideEl('rzPreset')">Custom px</button>
        <button class="tabBtn" onclick="setTab(this,'rzTabs');hideEl('rzCustom');showEl('rzPct');hideEl('rzPreset')">Percentage</button>
        <button class="tabBtn" onclick="setTab(this,'rzTabs');hideEl('rzCustom');hideEl('rzPct');showEl('rzPreset')">Presets</button>
      </div>
      <div id="rzCustom">
        <div class="g2" style="margin-bottom:10px">
          <div><label class="fl">Width (px)</label><input type="number" class="fc" id="rzW" placeholder="Width" oninput="lockAspect('rzW')"/></div>
          <div><label class="fl">Height (px)</label><input type="number" class="fc" id="rzH" placeholder="Height" oninput="lockAspect('rzH')"/></div>
        </div>
        <div class="crow" style="margin-bottom:12px"><input type="checkbox" id="rzLock" checked/><label for="rzLock">Lock aspect ratio</label></div>
      </div>
      <div id="rzPct" style="display:none">
        <label class="fl">Scale: <span id="rzPctV" style="color:var(--acc)">100%</span></label>
        <input type="range" min="5" max="400" value="100" id="rzPctR" oninput="document.getElementById('rzPctV').textContent=this.value+'%'" style="margin-bottom:12px"/>
      </div>
      <div id="rzPreset" style="display:none;margin-bottom:12px">
        <label class="fl">Social Media Preset</label>
        <select class="fc" id="rzPre" onchange="applyPreset()">
          <option value="">Select a presetâ€¦</option>
          <option value="1080x1080">Instagram Post (1080Ã—1080)</option>
          <option value="1080x1350">Instagram Portrait (1080Ã—1350)</option>
          <option value="1080x1920">Instagram Story / Reel (1080Ã—1920)</option>
          <option value="1280x720">YouTube Thumbnail (1280Ã—720)</option>
          <option value="2560x1440">YouTube Channel Art (2560Ã—1440)</option>
          <option value="820x312">Facebook Cover (820Ã—312)</option>
          <option value="1200x630">Facebook Post (1200Ã—630)</option>
          <option value="800x800">WhatsApp DP (800Ã—800)</option>
          <option value="1500x500">Twitter / X Header (1500Ã—500)</option>
          <option value="1200x627">OG / Share Image (1200Ã—627)</option>
          <option value="1128x191">LinkedIn Cover (1128Ã—191)</option>
          <option value="512x512">App Icon (512Ã—512)</option>
          <option value="192x192">PWA Icon (192Ã—192)</option>
          <option value="64x64">Favicon (64Ã—64)</option>
        </select>
      </div>
      <div class="crow" style="margin-bottom:10px"><input type="checkbox" id="rzBrand"/><label for="rzBrand">Add K Spider branding</label></div>
      <button class="btn btn-p" onclick="doResize()">â†”ï¸ Resize Image</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-crop" class="tool-sec">
    <div class="card">
      <div class="card-title">âœ‚ï¸ Image <b>Crop Tool</b></div>
      <div class="card-sub">Crop with free-form, fixed ratio, or preset aspect ratios. Upload image and click Start Crop.</div>
      <div class="g2" style="margin-bottom:12px">
        <div class="fg">
          <label class="fl">Aspect Ratio</label>
          <div class="tags" id="crRatio">
            <span class="tag on" onclick="setTag(this,'crRatio');setCropRatio('free')">Free</span>
            <span class="tag" onclick="setTag(this,'crRatio');setCropRatio(1)">1:1</span>
            <span class="tag" onclick="setTag(this,'crRatio');setCropRatio(4/3)">4:3</span>
            <span class="tag" onclick="setTag(this,'crRatio');setCropRatio(16/9)">16:9</span>
            <span class="tag" onclick="setTag(this,'crRatio');setCropRatio(3/4)">3:4</span>
            <span class="tag" onclick="setTag(this,'crRatio');setCropRatio(9/16)">9:16</span>
          </div>
        </div>
        <div class="fg">
          <div class="crow"><input type="checkbox" id="crBrand"/><label for="crBrand">Add K Spider branding</label></div>
        </div>
      </div>
      <div class="g2">
        <button class="btn btn-p" onclick="startCrop()">âœ‚ï¸ Start Crop Tool</button>
        <button class="btn btn-s" id="applyCropBtn" onclick="applyCrop()" style="display:none">âœ… Apply Crop</button>
      </div>
    </div>
    <div id="cropArea">
      <div class="card" style="padding:12px;overflow:hidden">
        <img id="cropImgEl" src="" alt="crop" style="max-width:100%;display:block"/>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROTATE & FLIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-rotate" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ”ƒ Rotate <b>& Flip</b></div>
      <div class="card-sub">Rotate by angle or flip horizontally/vertically.</div>
      <div class="fg">
        <label class="fl">Rotation Angle: <span id="rotV" style="color:var(--acc)">0Â°</span></label>
        <input type="range" min="-180" max="180" value="0" id="rotRange" oninput="document.getElementById('rotV').textContent=this.value+'Â°'"/>
      </div>
      <div class="g3" style="margin:14px 0">
        <button class="btn btn-s" onclick="quickRot(-90)">â†º 90Â° Left</button>
        <button class="btn btn-s" onclick="quickRot(90)">â†» 90Â° Right</button>
        <button class="btn btn-s" onclick="quickRot(180)">â†• 180Â°</button>
        <button class="btn btn-s" onclick="doFlip('h')">â‡” Flip H</button>
        <button class="btn btn-s" onclick="doFlip('v')">â‡• Flip V</button>
        <button class="btn btn-s" onclick="doFlip('both')">â†”â†• Both</button>
      </div>
      <div class="crow" style="margin-bottom:10px"><input type="checkbox" id="rotFill" checked/><label for="rotFill">Fill transparent area with white</label></div>
      <div class="crow" style="margin-bottom:12px"><input type="checkbox" id="rotBrand"/><label for="rotBrand">Add K Spider branding</label></div>
      <button class="btn btn-p" onclick="doRotate()">ğŸ”ƒ Apply Rotation</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-background" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ¨ Background <b>Tool</b></div>
      <div class="card-sub">Change background color, make transparent, apply blur, or add gradient.</div>
      <div class="fg">
        <label class="fl">Effect Type</label>
        <div class="tags" id="bgFx">
          <span class="tag on" onclick="setTag(this,'bgFx')">Color Fill</span>
          <span class="tag" onclick="setTag(this,'bgFx')">Transparent</span>
          <span class="tag" onclick="setTag(this,'bgFx')">Blur Effect</span>
          <span class="tag" onclick="setTag(this,'bgFx')">Gradient</span>
        </div>
      </div>
      <div class="g2">
        <div class="fg">
          <label class="fl">Primary Color</label>
          <input type="color" class="fc" id="bgC1" value="#ffffff" style="height:40px"/>
        </div>
        <div class="fg">
          <label class="fl">Gradient Color 2</label>
          <input type="color" class="fc" id="bgC2" value="#0055ff" style="height:40px"/>
        </div>
        <div class="fg">
          <label class="fl">Blur Intensity: <span id="bgBlurV" style="color:var(--acc)">10px</span></label>
          <input type="range" min="0" max="30" value="10" id="bgBlur" oninput="document.getElementById('bgBlurV').textContent=this.value+'px'"/>
        </div>
        <div class="fg">
          <label class="fl">Replace Tolerance: <span id="bgTolV" style="color:var(--acc)">40</span></label>
          <input type="range" min="10" max="120" value="40" id="bgTol" oninput="document.getElementById('bgTolV').textContent=this.value"/>
        </div>
      </div>
      <div class="crow" style="margin-bottom:10px"><input type="checkbox" id="bgBrand"/><label for="bgBrand">Add K Spider branding</label></div>
      <button class="btn btn-p" onclick="doBackground()">ğŸ¨ Apply Background</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ WATERMARK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-watermark" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ’§ <b>Watermark</b> Tool</div>
      <div class="card-sub">Add text or logo watermark. Control position, opacity, tiling.</div>
      <div class="tabs">
        <button class="tabBtn on" onclick="setTab(this,'wmTabs');showEl('wmText');hideEl('wmLogo')">Text Watermark</button>
        <button class="tabBtn" onclick="setTab(this,'wmTabs');hideEl('wmText');showEl('wmLogo')">Logo Watermark</button>
      </div>
      <div id="wmText">
        <div class="g2">
          <div class="fg" style="grid-column:1/-1">
            <label class="fl">Watermark Text</label>
            <input type="text" class="fc" id="wmTxt" value="Â© K Spider AI Tools â€” kspiderai.in"/>
          </div>
          <div class="fg">
            <label class="fl">Font Size: <span id="wmFsV" style="color:var(--acc)">40px</span></label>
            <input type="range" min="10" max="150" value="40" id="wmFs" oninput="document.getElementById('wmFsV').textContent=this.value+'px'"/>
          </div>
          <div class="fg">
            <label class="fl">Text Color</label>
            <input type="color" class="fc" id="wmClr" value="#ffffff" style="height:38px"/>
          </div>
        </div>
        <div class="crow" style="margin-bottom:8px"><input type="checkbox" id="wmShadow" checked/><label for="wmShadow">Drop shadow</label></div>
      </div>
      <div id="wmLogo" style="display:none">
        <div class="fg">
          <label class="fl">Logo Image File</label>
          <input type="file" accept="image/*" class="fc" id="wmLogoFile" style="padding:5px"/>
        </div>
        <div class="fg">
          <label class="fl">Logo Size: <span id="wmLsV" style="color:var(--acc)">20%</span></label>
          <input type="range" min="5" max="70" value="20" id="wmLs" oninput="document.getElementById('wmLsV').textContent=this.value+'%'"/>
        </div>
      </div>
      <div class="g2" style="margin-top:10px">
        <div class="fg">
          <label class="fl">Opacity: <span id="wmOpV" style="color:var(--acc)">60%</span></label>
          <input type="range" min="5" max="100" value="60" id="wmOp" oninput="document.getElementById('wmOpV').textContent=this.value+'%'"/>
        </div>
        <div class="fg">
          <label class="fl">Position</label>
          <div class="wmgrid" id="wmPosGrid">
            <div class="wmcell" onclick="setWmPos(this,'top-left')">â†– TL</div>
            <div class="wmcell" onclick="setWmPos(this,'top-center')">â¬† TC</div>
            <div class="wmcell" onclick="setWmPos(this,'top-right')">â†— TR</div>
            <div class="wmcell" onclick="setWmPos(this,'mid-left')">â† ML</div>
            <div class="wmcell on" onclick="setWmPos(this,'center')">âŠ• C</div>
            <div class="wmcell" onclick="setWmPos(this,'mid-right')">â†’ MR</div>
            <div class="wmcell" onclick="setWmPos(this,'bot-left')">â†™ BL</div>
            <div class="wmcell" onclick="setWmPos(this,'bot-center')">â¬‡ BC</div>
            <div class="wmcell" onclick="setWmPos(this,'bot-right')">â†˜ BR</div>
          </div>
        </div>
      </div>
      <div class="crow" style="margin-bottom:6px"><input type="checkbox" id="wmTile"/><label for="wmTile">Tile watermark across image</label></div>
      <div class="crow" style="margin-bottom:10px"><input type="checkbox" id="wmRot" checked/><label for="wmRot">Rotate when tiling (diagonal)</label></div>
      <button class="btn btn-p" onclick="doWatermark()">ğŸ’§ Apply Watermark</button>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BATCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-batch" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ—‚ <b>Batch</b> Processor</div>
      <div class="card-sub">Upload multiple images, apply one operation to all, download as ZIP.</div>
      <div class="g2" style="margin-bottom:12px">
        <div class="fg">
          <label class="fl">Operation to Apply</label>
          <select class="fc" id="batchOp">
            <option value="compress80">Compress (Quality 80%)</option>
            <option value="compress60">Compress (Quality 60%)</option>
            <option value="toJpg">Convert to JPG</option>
            <option value="toPng">Convert to PNG</option>
            <option value="toWebp">Convert to WEBP</option>
            <option value="grayscale">Grayscale</option>
            <option value="resize50">Resize to 50%</option>
            <option value="resize25">Resize to 25%</option>
            <option value="sepia">Sepia Tone</option>
            <option value="invert">Invert Colors</option>
          </select>
        </div>
        <div class="fg">
          <div class="crow" style="margin-top:20px"><input type="checkbox" id="batchBrand"/><label for="batchBrand">Add K Spider branding</label></div>
        </div>
      </div>
      <button class="btn btn-p" onclick="document.getElementById('multiIn').click()" style="margin-bottom:10px">ğŸ—‚ Upload Multiple Images</button>
      <div id="batchList"></div>
      <div id="batchActs" style="display:none;margin-top:12px">
        <div class="g2">
          <button class="btn btn-p" onclick="doBatch()">âš¡ Process All</button>
          <button class="btn btn-info" onclick="batchZip()">ğŸ“¦ Download ZIP</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MONETIZE / SUPPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-monetize" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ’° Support <b>K Spider</b></div>
      <div class="card-sub">This tool is 100% free. Help us grow so we can add more features!</div>
      <div class="mon-card yt-card">
        <div style="font-size:36px;margin-bottom:8px">ğŸ¬</div>
        <div style="font-weight:700;font-size:16px;margin-bottom:6px">Subscribe on YouTube</div>
        <p style="font-size:13px;color:var(--t1);margin-bottom:14px">Watch free tutorials on image editing, AI tools, and digital creativity.</p>
        <a href="https://www.youtube.com/@KSpider4Kreaction" target="_blank" class="btn btn-red" style="max-width:260px;margin:0 auto;display:flex;color:#fff">â–¶ Subscribe @KSpider4Kreaction</a>
      </div>
      <div class="mon-card upi-card" style="margin-top:12px">
        <div style="font-size:36px;margin-bottom:8px">â˜•</div>
        <div style="font-weight:700;font-size:16px;margin-bottom:6px">Buy Us a Coffee</div>
        <p style="font-size:13px;color:var(--t1);margin-bottom:6px">Support server costs and future development via UPI.</p>
        <p style="font-family:'Space Mono',monospace;font-size:13px;color:var(--acc);margin-bottom:14px">UPI: kspider221206@gmail.com</p>
        <button class="btn btn-p" onclick="copyUpi()" style="max-width:220px;margin:0 auto">ğŸ“‹ Copy UPI ID</button>
      </div>
      <div style="background:var(--bg2);border:1px solid var(--bdr);border-radius:12px;padding:16px;margin-top:12px;text-align:center">
        <div style="font-weight:700;font-size:15px;margin-bottom:12px">â­ Rate This Tool</div>
        <div class="stars" id="stars">
          <span class="star" onclick="rateTool(1)">â˜…</span>
          <span class="star" onclick="rateTool(2)">â˜…</span>
          <span class="star" onclick="rateTool(3)">â˜…</span>
          <span class="star" onclick="rateTool(4)">â˜…</span>
          <span class="star" onclick="rateTool(5)">â˜…</span>
        </div>
        <div id="rateMsg" style="font-size:13px;color:var(--t1)">Click a star to rate</div>
      </div>
      <div style="background:var(--bg2);border:1px solid var(--bdr);border-radius:12px;padding:16px;margin-top:12px;text-align:center">
        <div style="font-weight:700;font-size:15px;margin-bottom:12px">ğŸ“£ Share this Tool</div>
        <div class="share-row">
          <button class="sh-btn" style="background:#25D366" onclick="shareWA()">ğŸ’¬ WhatsApp</button>
          <button class="sh-btn" style="background:#1877f2" onclick="shareFB()">Facebook</button>
          <button class="sh-btn" style="background:#1da1f2" onclick="shareTwitter()">ğ• Twitter</button>
          <button class="sh-btn" style="background:#0077b5" onclick="shareLI()">LinkedIn</button>
          <button class="sh-btn" style="background:var(--acc);color:#000" onclick="copyLink()">ğŸ”— Copy Link</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LEGAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-legal" class="tool-sec">
    <div class="card">
      <div class="card-title">ğŸ“‹ Legal <b>& Policy</b></div>
      <div class="card-sub">Full transparency about how K Spider Image Master Pro works.</div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸ”’ Disclaimer <span class="col-arr">â–¼</span></div><div class="col-body"><p>K Spider Image Master Pro does <strong>not</strong> store, upload, or transmit your images to any server. All image processing happens entirely within your web browser using JavaScript Canvas API and FileReader API. When you close or refresh the page, all image data is automatically cleared from memory. This tool is provided for convenience purposes only. Results may vary based on browser capabilities. The developers are not responsible for any data loss or quality differences. Always keep backup copies of important images.</p></div></div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸ›¡ Privacy Policy <span class="col-arr">â–¼</span></div><div class="col-body"><p><strong>No data stored, ever.</strong> We do not collect, log, store, or sell any personal data or image files. Your images never leave your device.</p><p style="margin-top:8px"><strong>Analytics:</strong> We may use Google Analytics for anonymous usage statistics. No images or personal data are included.</p><p style="margin-top:8px"><strong>Advertising:</strong> Google AdSense may display relevant ads and use cookies. This is governed by Google's privacy policy. Image content is never shared with advertisers.</p><p style="margin-top:8px"><strong>Contact:</strong> kspider221206@gmail.com | www.kspiderai.in</p></div></div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸ“‹ Terms of Use <span class="col-arr">â–¼</span></div><div class="col-body"><ul style="margin-left:18px"><li>You may use this tool for personal and commercial image processing</li><li>You must not use this tool for illegal purposes or copyright infringement</li><li>You retain full rights to all images you process</li><li>The tool is provided "as is" without warranty of any kind</li><li>Maximum file size: 10MB per image on free tier</li><li>The branding watermark feature is optional and free to use</li></ul></div></div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸ¤– AI Limitation Notice <span class="col-arr">â–¼</span></div><div class="col-body"><p>The "AI Smart Suggestions" and "AI Smart Compression" features use rule-based heuristics running entirely in your browser. No external AI API or server-side machine learning is used. Suggestions are based on file size, dimensions, and format â€” not deep neural network analysis. Results should be treated as helpful hints, not professional recommendations.</p></div></div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸ“£ AdSense Compliance <span class="col-arr">â–¼</span></div><div class="col-body"><p>K Spider Image Master Pro complies with Google AdSense policies. This site does not contain adult content, misleading content, or content that violates Google's program policies. All processing is user-initiated. No auto-redirect, pop-under, or aggressive ad placement is used.</p></div></div>
      <div class="col-sec"><div class="col-hdr" onclick="toggleCol(this)">ğŸŒ India + Global Compliance <span class="col-arr">â–¼</span></div><div class="col-body"><p>This tool complies with IT Act 2000 (India), GDPR (Europe), CCPA (California), and general global data protection principles. No personal data is collected or stored. No cookies beyond analytics/advertising are used. This tool respects copyright â€” it does not bypass DRM or enable downloading of protected content.</p></div></div>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ABOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="sec-about" class="tool-sec">
    <div class="card" style="text-align:center">
      <div style="width:80px;height:80px;background:linear-gradient(135deg,var(--acc),#c4821a);border-radius:20px;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:38px;font-weight:700;color:#000;margin:0 auto 16px;box-shadow:0 4px 24px rgba(245,166,35,.4)">KS</div>
      <h1 style="font-family:'Rajdhani',sans-serif;font-size:24px;margin-bottom:6px">K Spider Image Master Pro</h1>
      <p style="font-size:13.5px;color:var(--t1);max-width:440px;margin:0 auto 8px">A world-class browser-based image processing platform. 100% free. 100% private. Zero server uploads. Built with love in India.</p>
      <p style="font-size:12px;color:var(--t2);margin-bottom:18px">ğŸ‘¨â€ğŸ‘¦ Developed by: <strong style="color:var(--t1)">Father â€“ Gaurang Raval & Son â€“ Khush Raval</strong></p>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px">
        <a href="https://www.kspiderai.in" target="_blank" class="dz-btn p" style="display:inline-block">ğŸŒ Website</a>
        <a href="https://www.youtube.com/@KSpider4Kreaction" target="_blank" class="dz-btn" style="display:inline-block">â–¶ YouTube</a>
        <a href="mailto:kspider221206@gmail.com" class="dz-btn" style="display:inline-block">ğŸ“§ Email</a>
      </div>
      <div style="background:var(--bg2);border-radius:10px;border:1px solid var(--bdr);padding:14px;font-size:12.5px;color:var(--t1);line-height:2">
        <div style="font-size:11px;color:var(--t2);margin-bottom:8px;font-weight:700;text-transform:uppercase;letter-spacing:1px">Features in v3.0</div>
        ğŸ”„ Convert (JPG/PNG/WEBP/PDF/ICO) &nbsp;|&nbsp; ğŸ“¦ Compress (Manual/Target/AI)<br>
        ğŸªª Passport Photo (8 templates, A4/A3/Letter, PDF) &nbsp;|&nbsp; â†”ï¸ Resize + Social Presets<br>
        âœ‚ï¸ Crop (Free/Ratio) &nbsp;|&nbsp; ğŸ”ƒ Rotate & Flip &nbsp;|&nbsp; ğŸ¨ Background Tools<br>
        ğŸ’§ Watermark (Text+Logo, 9-Point) &nbsp;|&nbsp; ğŸ—‚ Batch Process + ZIP Download<br>
        ğŸ“· Camera Capture &nbsp;|&nbsp; ğŸ’¬ WhatsApp Share &nbsp;|&nbsp; ğŸŒ™ Dark/Light Mode
      </div>
    </div>
  </div>

</div><!-- /previewArea -->
</main>
</div><!-- /wrap -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer id="footer">
  <div>
    <div class="footer-brand">K Spider <b>Image Master Pro</b></div>
    <div style="font-size:10.5px;color:var(--t2);margin-top:2px">ğŸ‘¨â€ğŸ‘¦ Father â€“ Gaurang Raval & Son â€“ Khush Raval</div>
  </div>
  <div class="footer-links">
    <a href="#" onclick="go('legal');return false">Privacy Policy</a>
    <a href="#" onclick="go('legal');return false">Disclaimer</a>
    <a href="#" onclick="go('legal');return false">Terms</a>
    <a href="https://www.kspiderai.in" target="_blank">Website</a>
    <a href="mailto:kspider221206@gmail.com">Contact</a>
  </div>
  <div class="powered">
    Powered by <a href="https://www.kspiderai.in" target="_blank">K Spider AI Tool</a> â€”
    <a href="https://www.kspiderai.in" target="_blank">www.kspiderai.in</a> â€”
    <a href="https://www.youtube.com/@KSpider4Kreaction" target="_blank">@KSpider4Kreaction</a>
  </div>
</footer>

<!-- LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   K Spider Image Master Pro v3.0
   100% Client-Side | No Backend | No Server Storage
   Brand: K Spider AI Tools | www.kspiderai.in
   Developer: Fatherâ€“Gaurang Raval & Sonâ€“Khush Raval
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ CONSTANTS â”€â”€ */
const BRAND = 'Powered by K Spider AI Tool â€“ www.kspiderai.in â€“ @KSpider4Kreaction';
const MAX_MB = 10;
const ALLOWED = ['image/jpeg','image/png','image/webp','image/gif','image/bmp','image/svg+xml','image/heic','image/avif'];

/* â”€â”€ STATE â”€â”€ */
const S = {
  origFile: null, origImg: null, origDataURL: null,
  procDataURL: null,           // result of last processing
  lastFn: null,                // for regenerate
  currModule: 'home',
  wmPos: 'center',
  wmMode: 'text',
  dlQuality: 0.82,
  camStream: null,
  isDark: true,
  userName: '',
  batchFiles: [], batchResults: [],
  cropperInst: null,
  rotAngle: 0, flipH: false, flipV: false
};

/* â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', () => {
  const saved = sessionStorage.getItem('ks_name');
  if (saved) { S.userName = saved; document.getElementById('unInput').value = saved; document.getElementById('waName').value = saved; }
  buildWaMsg();
  // Paper tag watcher for passport
  document.getElementById('ppPaper').addEventListener('click', e => {
    if (e.target.classList.contains('tag')) {
      document.getElementById('ppCustomPaper').style.display = e.target.textContent.trim()==='Custom' ? 'block' : 'none';
    }
  });
});

/* â•â•â•â•â•â•â•â•â•â•â•â• THEME â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleTheme() {
  S.isDark = !S.isDark;
  document.body.classList.toggle('lm', !S.isDark);
  document.getElementById('themeBtn').textContent = S.isDark ? 'ğŸŒ™' : 'â˜€ï¸';
}

/* â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleSidebar() { document.getElementById('sb').classList.toggle('open'); }

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE NAVIGATION â•â•â•â•â•â•â•â•â•â•â•â• */
function go(name) {
  S.currModule = name;
  // Update nav highlights
  document.querySelectorAll('.ni').forEach(n => n.classList.remove('on'));
  const nav = document.getElementById('nav-' + name);
  if (nav) nav.classList.add('on');
  // Show correct tool section
  document.querySelectorAll('.tool-sec').forEach(s => s.classList.remove('on'));
  const sec = document.getElementById('sec-' + name);
  if (sec) sec.classList.add('on');
  // Static pages need no image
  const staticPages = ['home','legal','about','monetize'];
  if (staticPages.includes(name)) {
    document.getElementById('dropZone').style.display = 'none';
    document.getElementById('previewArea').style.display = 'block';
    document.getElementById('infobar').style.display = 'none';
    document.getElementById('aiBox').style.display = 'none';
    document.getElementById('cvWrap').style.display = 'none';
    document.getElementById('outBox').style.display = 'none';
    document.getElementById('actRow').style.display = 'none';
  } else if (S.origImg) {
    document.getElementById('cvWrap').style.display = 'flex';
    document.getElementById('infobar').style.display = 'flex';
    if (name === 'crop') startCrop();
  }
  document.getElementById('sb').classList.remove('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• USER NAME â•â•â•â•â•â•â•â•â•â•â•â• */
function saveName() {
  const v = sanitize(document.getElementById('unInput').value);
  if (!v) { showAlert('Please enter your name.','err'); return; }
  S.userName = v;
  sessionStorage.setItem('ks_name', v);
  document.getElementById('waName').value = v;
  buildWaMsg();
  const el = document.getElementById('unSavedMsg');
  el.style.display = 'block';
  setTimeout(()=> el.style.display='none', 2500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• FILE VALIDATION â•â•â•â•â•â•â•â•â•â•â•â• */
function validateFile(f) {
  if (!ALLOWED.includes(f.type)) { showAlert(`Unsupported: ${f.type}. Use JPG/PNG/WEBP/GIF/BMP/SVG.`,'err'); return false; }
  if (f.size > MAX_MB*1024*1024) { showAlert(`File too large. Max ${MAX_MB}MB. Your file: ${fmtBytes(f.size)}`,'err'); return false; }
  return true;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• FILE LOADING â•â•â•â•â•â•â•â•â•â•â•â• */
function handleDrop(e) {
  const files = e.dataTransfer.files;
  if (files.length > 1) { loadBatch(files); return; }
  if (files[0]) loadFile(files[0]);
}

function loadFile(file) {
  if (!validateFile(file)) return;
  S.origFile = file;
  const reader = new FileReader();
  reader.onload = ev => {
    S.origDataURL = ev.target.result;
    const img = new Image();
    img.onload = () => {
      S.origImg = img; S.procDataURL = null;
      renderOrig(); showPreview(); aiSuggest(file, img);
    };
    img.onerror = () => showAlert('Failed to load image file.','err');
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
}

function renderOrig() {
  const img = S.origImg, c = document.getElementById('mainCanvas');
  const mW=820, mH=420; let w=img.width, h=img.height;
  if (w>mW){h=Math.round(h*mW/w);w=mW;}
  if (h>mH){w=Math.round(w*mH/h);h=mH;}
  c.width=w; c.height=h;
  c.getContext('2d').drawImage(img,0,0,w,h);
  document.getElementById('rzW').value = img.width;
  document.getElementById('rzH').value = img.height;
}

function showPreview() {
  document.getElementById('dropZone').style.display = 'none';
  const pa = document.getElementById('previewArea');
  pa.style.display = 'block'; pa.classList.add('fade-in');
  document.getElementById('cvWrap').style.display = 'flex';
  document.getElementById('infobar').style.display = 'flex';
  document.getElementById('dlBtn').style.display = 'flex';
  document.getElementById('waBtn').style.display = 'flex';
  document.getElementById('resetBtn').style.display = 'flex';
  const f=S.origFile, img=S.origImg;
  document.getElementById('iName').textContent = f.name.length>18 ? f.name.substr(0,16)+'â€¦' : f.name;
  document.getElementById('iSize').textContent = fmtBytes(f.size);
  document.getElementById('iDims').textContent = img.width+'Ã—'+img.height;
  document.getElementById('iFmt').textContent = (f.type.split('/')[1]||'img').toUpperCase();
  if (S.currModule==='home') go('home');
  document.getElementById('waName').value = S.userName;
  buildWaMsg();
}

/* â•â•â•â•â•â•â•â•â•â•â•â• AI SUGGESTIONS â•â•â•â•â•â•â•â•â•â•â•â• */
function aiSuggest(f, img) {
  const tips=[], kb=f.size/1024;
  if (kb>800) tips.push(`ğŸ“¦ Image is ${fmtBytes(f.size)}. Compress to under 200KB for web/email use.`);
  if (img.width>3000||img.height>3000) tips.push(`ğŸ“ High res (${img.width}Ã—${img.height}). Resize to 1080Ã—1080 for social media.`);
  if (f.type==='image/png') tips.push('ğŸ”„ PNG detected. No transparency? Convert to JPG/WEBP to save 60-70% size.');
  if (img.width===img.height) tips.push('ğŸ“· Square image â€” perfect for Instagram Post (1080Ã—1080).');
  if (img.width>img.height*1.7) tips.push('ğŸ–¼ Wide landscape â€” ideal for YouTube Thumbnail (1280Ã—720) or FB Cover.');
  if (img.height>img.width*1.7) tips.push('ğŸ“± Tall portrait â€” use for Instagram Story (1080Ã—1920).');
  if (kb<50) tips.push('âœ… Already optimized. No compression needed.');
  tips.push(`ğŸ’¡ Best format: ${f.type==='image/png'?'WEBP (smallest) or PNG (transparency)':'WEBP for best quality+size ratio.'}`);
  document.getElementById('aiTips').innerHTML = tips.map(t=>`<div class="ai-tip">${t}</div>`).join('');
  document.getElementById('aiBox').style.display = 'block';
}

/* â•â•â•â•â•â•â•â•â•â•â•â• RESET â•â•â•â•â•â•â•â•â•â•â•â• */
function resetAll() {
  S.origFile=S.origImg=S.origDataURL=S.procDataURL=null;
  S.batchFiles=[]; S.batchResults=[];
  if(S.cropperInst){S.cropperInst.destroy();S.cropperInst=null;}
  document.getElementById('fileIn').value='';
  document.getElementById('multiIn').value='';
  document.getElementById('dropZone').style.display='block';
  document.getElementById('previewArea').style.display='none';
  ['dlBtn','waBtn','resetBtn'].forEach(id=>document.getElementById(id).style.display='none');
  document.getElementById('outBox').style.display='none';
  document.getElementById('actRow').style.display='none';
  document.getElementById('passportOut').style.display='none';
  document.getElementById('cropArea').style.display='none';
  document.getElementById('applyCropBtn').style.display='none';
  document.getElementById('batchList').innerHTML='';
  document.getElementById('batchActs').style.display='none';
  hideAlert();
}

/* â•â•â•â•â•â•â•â•â•â•â•â• BRANDING WATERMARK â•â•â•â•â•â•â•â•â•â•â•â• */
function addBrand(ctx, w, h) {
  ctx.save();
  ctx.globalAlpha=0.22; ctx.fillStyle='#ffffff';
  ctx.font=`bold ${Math.max(11,Math.round(w/60))}px sans-serif`;
  ctx.textAlign='right'; ctx.textBaseline='bottom';
  ctx.shadowColor='rgba(0,0,0,0.6)'; ctx.shadowBlur=4;
  ctx.fillText('kspiderai.in', w-10, h-8);
  ctx.restore();
}

/* â•â•â•â•â•â•â•â•â•â•â•â• COLOR MODE HELPER â•â•â•â•â•â•â•â•â•â•â•â• */
function applyColor(ctx, canvas, mode) {
  if (mode==='RGB (Original)') return;
  const id=ctx.getImageData(0,0,canvas.width,canvas.height), d=id.data;
  for(let i=0;i<d.length;i+=4){
    const r=d[i],g=d[i+1],b=d[i+2];
    if(mode==='Grayscale'){const gr=r*.299+g*.587+b*.114;d[i]=d[i+1]=d[i+2]=gr;}
    else if(mode==='Sepia Tone'){d[i]=Math.min(255,r*.393+g*.769+b*.189);d[i+1]=Math.min(255,r*.349+g*.686+b*.168);d[i+2]=Math.min(255,r*.272+g*.534+b*.131);}
    else if(mode==='Invert Colors'){d[i]=255-r;d[i+1]=255-g;d[i+2]=255-b;}
  }
  ctx.putImageData(id,0,0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: CONVERT â•â•â•â•â•â•â•â•â•â•â•â• */
function doConvert() {
  if(!needImg()) return;
  S.lastFn = doConvert;
  const fmt  = getTag('cvFmt');
  const q    = parseInt(document.getElementById('cvQ').value)/100;
  const mode = document.getElementById('cvColor').value;
  const brand= document.getElementById('cvBrand').checked;
  showProg();
  setTimeout(()=>{
    const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
    ctx.drawImage(img,0,0); applyColor(ctx,c,mode);
    if(fmt==='ICO'){
      const ic=mkCanvas(64,64); ic.getContext('2d').drawImage(img,0,0,64,64);
      S.procDataURL=ic.toDataURL('image/png');
      hideProg(); drawToMain(ic); updOut(S.origFile.size,S.procDataURL,'64Ã—64');
      showAct(); showAlert('âœ… ICO ready (64Ã—64). Click Download.','ok');
      return;
    }
    if(fmt==='PDF'){
      if(brand) addBrand(ctx,c.width,c.height);
      S.procDataURL=c.toDataURL('image/png');
      hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
      showAct(); showAlert('âœ… Ready as PDF. Click Download â†’ select PDF.','info');
      return;
    }
    let mime='image/jpeg';
    if(fmt==='PNG') mime='image/png';
    if(fmt==='WEBP') mime='image/webp';
    if(brand) addBrand(ctx,c.width,c.height);
    S.procDataURL=c.toDataURL(mime,q);
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
    showAct(); showAlert(`âœ… Converted to ${fmt} at ${Math.round(q*100)}% quality.`,'ok');
  },120);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: COMPRESS â•â•â•â•â•â•â•â•â•â•â•â• */
function doCompress() {
  if(!needImg()) return;
  S.lastFn = doCompress;
  const mode  = document.querySelector('#cmpTabs .tabBtn.on')?.textContent?.trim()||'Manual';
  const brand = document.getElementById('cmpBrand').checked;
  if(mode.includes('AI')) { doSmartCompress(brand); return; }
  if(mode.includes('Target')) { doTargetCompress(brand); return; }
  const q = parseInt(document.getElementById('cmpQ').value)/100;
  showProg();
  setTimeout(()=>{
    const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
    ctx.drawImage(img,0,0);
    if(brand) addBrand(ctx,c.width,c.height);
    S.procDataURL=c.toDataURL('image/jpeg',q);
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
    showAct(); showAlert(`âœ… Compressed at ${Math.round(q*100)}% quality.`,'ok');
  },200);
}
function doSmartCompress(brand) {
  showProg();
  setTimeout(()=>{
    const kb=S.origFile.size/1024;
    let q=0.85;
    if(kb>4000)q=0.5; else if(kb>2000)q=0.6; else if(kb>1000)q=0.7; else if(kb>500)q=0.78;
    const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
    ctx.drawImage(img,0,0);
    if(brand) addBrand(ctx,c.width,c.height);
    S.procDataURL=c.toDataURL('image/jpeg',q);
    document.getElementById('cmpQ').value=Math.round(q*100);
    document.getElementById('cmpQV').textContent=Math.round(q*100)+'%';
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
    showAct(); showAlert(`ğŸ¤– AI chose ${Math.round(q*100)}% quality for best balance.`,'ok');
  },450);
}
function doTargetCompress(brand) {
  const target=parseInt(document.getElementById('cmpTargKB').value)||100;
  showProg();
  setTimeout(()=>{
    const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
    ctx.drawImage(img,0,0);
    // Binary search
    let lo=0.05,hi=1.0,best=null;
    for(let i=0;i<18;i++){
      const mid=(lo+hi)/2, d=c.toDataURL('image/jpeg',mid), sz=Math.round(d.length*3/4/1024);
      if(sz<=target){best=d;lo=mid;}else{hi=mid;}
      if(hi-lo<0.008) break;
    }
    if(brand){ctx.drawImage(img,0,0);addBrand(ctx,c.width,c.height);}
    S.procDataURL=best||c.toDataURL('image/jpeg',0.08);
    const finalKB=Math.round(S.procDataURL.length*3/4/1024);
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
    showAct(); showAlert(`âœ… Compressed to ~${finalKB}KB (target: ${target}KB).`,'ok');
  },300);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: PASSPORT â•â•â•â•â•â•â•â•â•â•â•â• */
const PP_TMPLS = {
  '35x45':{w:35,h:45},'50x50':{w:50,h:50},'35x45c':{w:35,h:45},
  '25x35':{w:25,h:35},'35x35':{w:35,h:35},'35x45d':{w:35,h:45},
  '45x35':{w:45,h:35},'40x60':{w:40,h:60}
};
const PP_PAPERS = { 'A4':{w:210,h:297}, 'A3':{w:297,h:420}, 'Letter':{w:216,h:279} };

function ppTmplChange() {
  document.getElementById('ppCustomSize').style.display =
    document.getElementById('ppTmpl').value==='custom' ? 'block' : 'none';
}

function doPassport() {
  if(!needImg()) return;
  S.lastFn = doPassport;

  // Get photo size
  const tmplKey = document.getElementById('ppTmpl').value;
  let tmpl;
  if(tmplKey==='custom') {
    tmpl={w:parseFloat(document.getElementById('ppCW').value)||35, h:parseFloat(document.getElementById('ppCH').value)||45};
  } else { tmpl=PP_TMPLS[tmplKey]||{w:35,h:45}; }

  // Get paper size
  const paperTag = getTag('ppPaper');
  let paper;
  if(paperTag==='Custom') {
    paper={w:parseFloat(document.getElementById('ppPW').value)||210, h:parseFloat(document.getElementById('ppPH').value)||297};
  } else { paper=PP_PAPERS[paperTag]||PP_PAPERS['A4']; }

  // Orientation
  const orient = getTag('ppOrient');
  if(orient==='Landscape') { const tmp=paper.w; paper.w=paper.h; paper.h=tmp; }

  // Copies
  const copies = parseInt(getTag('ppCopies'))||8;

  // Background
  const bgTag = getTag('ppBg');
  let bg='#ffffff';
  if(bgTag==='Light Blue') bg='#aac4e8';
  else if(bgTag==='Off White') bg='#fafaf0';
  else if(bgTag==='Custom') bg=document.getElementById('ppBgCustom').value;

  const margin = parseInt(document.getElementById('ppMar').value)||12;
  const brand  = document.getElementById('ppBrand').checked;
  const guide  = document.getElementById('ppGuide').checked;

  // 300 DPI canvas
  const DPI=300, MM=DPI/25.4;
  const PW=Math.round(paper.w*MM), PH=Math.round(paper.h*MM);
  const FW=Math.round(tmpl.w*MM),  FH=Math.round(tmpl.h*MM);

  const ppC = document.getElementById('ppCanvas');
  ppC.width=PW; ppC.height=PH;
  const ctx=ppC.getContext('2d');

  // White paper
  ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,PW,PH);

  // Calculate grid
  const cols = Math.max(1, Math.floor((PW - margin) / (FW + margin)));
  const rows  = Math.ceil(copies / cols);
  const gridW = cols*(FW+margin)+margin;
  const startX= Math.floor((PW-gridW)/2)+margin;
  const startY= margin+30;

  let cnt=0;
  const img=S.origImg;
  const scale=Math.max(FW/img.width, FH/img.height);
  const sw=FW/scale, sh=FH/scale;
  const sx=(img.width-sw)/2, sy=(img.height-sh)/2;

  outer: for(let r=0;r<rows;r++){
    for(let c2=0;c2<cols;c2++){
      if(cnt>=copies) break outer;
      const x=startX+c2*(FW+margin);
      const y=startY+r*(FH+margin);
      // BG fill
      ctx.fillStyle=bg; ctx.fillRect(x,y,FW,FH);
      // Draw photo
      ctx.drawImage(img,sx,sy,sw,sh,x,y,FW,FH);
      // Cut guide
      if(guide){
        ctx.strokeStyle='rgba(100,100,100,0.4)';
        ctx.setLineDash([4,4]); ctx.lineWidth=1;
        ctx.strokeRect(x,y,FW,FH);
        ctx.setLineDash([]);
      } else {
        ctx.strokeStyle='#cccccc'; ctx.lineWidth=1;
        ctx.strokeRect(x,y,FW,FH);
      }
      cnt++;
    }
  }

  // Size info
  ctx.fillStyle='rgba(0,0,0,0.25)'; ctx.font=`bold ${Math.round(PW/80)}px sans-serif`;
  ctx.textAlign='left'; ctx.textBaseline='top';
  ctx.fillText(`${tmpl.w}Ã—${tmpl.h}mm | ${DPI}DPI | ${copies} copies`, startX, 8);

  // Branding
  if(brand){
    ctx.fillStyle='rgba(0,0,0,0.18)'; ctx.font=`bold ${Math.round(PW/90)}px sans-serif`;
    ctx.textAlign='center'; ctx.textBaseline='bottom';
    ctx.fillText('K Spider AI Tool â€“ kspiderai.in', PW/2, PH-8);
  }

  document.getElementById('passportOut').style.display='block';
  showAct(); showAlert(`âœ… ${copies} passport photos (${tmpl.w}Ã—${tmpl.h}mm) generated on ${paperTag}!`,'ok');
}

function dlPassport(type) {
  const c = document.getElementById('ppCanvas');
  if(!c.width){showAlert('Generate passport photos first.','err');return;}
  if(type==='jpg'){
    dlData(c.toDataURL('image/jpeg',0.96),'kspider_passport.jpg');
    showAlert('ğŸ“¸ Passport JPG downloaded!','ok');
  } else {
    const { jsPDF }=window.jspdf;
    const paperTag=getTag('ppPaper');
    let paper=PP_PAPERS[paperTag]||PP_PAPERS['A4'];
    const orient=getTag('ppOrient')==='Landscape'?'l':'p';
    const pdf=new jsPDF({orientation:orient,unit:'mm',format:[paper.w,paper.h]});
    const img=c.toDataURL('image/jpeg',0.96);
    const pw=orient==='l'?paper.h:paper.w, ph=orient==='l'?paper.w:paper.h;
    pdf.addImage(img,'JPEG',0,0,pw,ph);
    pdf.setFontSize(5); pdf.setTextColor(160,160,160);
    pdf.text(BRAND,pw/2,ph-2,{align:'center'});
    pdf.save('kspider_passport.pdf');
    showAlert('ğŸ“„ Passport PDF exported!','ok');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: RESIZE â•â•â•â•â•â•â•â•â•â•â•â• */
function applyPreset() {
  const v=document.getElementById('rzPre').value;
  if(!v) return;
  const [w,h]=v.split('x').map(Number);
  document.getElementById('rzW').value=w;
  document.getElementById('rzH').value=h;
}

function lockAspect(changed) {
  if(!S.origImg||!document.getElementById('rzLock').checked) return;
  const r=S.origImg.width/S.origImg.height;
  if(changed==='rzW'){
    const w=parseInt(document.getElementById('rzW').value)||1;
    document.getElementById('rzH').value=Math.round(w/r);
  } else {
    const h=parseInt(document.getElementById('rzH').value)||1;
    document.getElementById('rzW').value=Math.round(h*r);
  }
}

function doResize() {
  if(!needImg()) return;
  S.lastFn=doResize;
  const activeTab = document.querySelector('#rzTabs .tabBtn.on')?.textContent?.trim()||'Custom px';
  const brand=document.getElementById('rzBrand').checked;
  const img=S.origImg;
  let tw,th;
  if(activeTab.includes('Percent')){
    const p=parseInt(document.getElementById('rzPctR').value)/100;
    tw=Math.round(img.width*p); th=Math.round(img.height*p);
  } else {
    tw=parseInt(document.getElementById('rzW').value)||img.width;
    th=parseInt(document.getElementById('rzH').value)||img.height;
  }
  if(tw<1||th<1){showAlert('Invalid dimensions.','err');return;}
  showProg();
  setTimeout(()=>{
    const c=mkCanvas(tw,th), ctx=c.getContext('2d');
    ctx.imageSmoothingQuality='high'; ctx.drawImage(img,0,0,tw,th);
    if(brand) addBrand(ctx,tw,th);
    S.procDataURL=c.toDataURL('image/jpeg',0.93);
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL,tw+'Ã—'+th);
    showAct(); showAlert(`âœ… Resized to ${tw}Ã—${th}px!`,'ok');
  },150);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: CROP â•â•â•â•â•â•â•â•â•â•â•â• */
function setCropRatio(r) { if(S.cropperInst) S.cropperInst.setAspectRatio(typeof r==='string'?NaN:r); }

function startCrop() {
  if(!needImg()) return;
  if(S.cropperInst){S.cropperInst.destroy();S.cropperInst=null;}
  const area=document.getElementById('cropArea');
  area.style.display='block';
  const el=document.getElementById('cropImgEl');
  el.src=S.origDataURL;
  S.cropperInst=new Cropper(el,{viewMode:1,autoCropArea:0.85,responsive:true});
  document.getElementById('applyCropBtn').style.display='flex';
  showAlert('ğŸ–± Drag to adjust crop. Click Apply Crop when ready.','info');
}

function applyCrop() {
  if(!S.cropperInst){showAlert('Start Crop Tool first.','err');return;}
  const brand=document.getElementById('crBrand').checked;
  const cropped=S.cropperInst.getCroppedCanvas({imageSmoothingQuality:'high'});
  const ctx=cropped.getContext('2d');
  if(brand) addBrand(ctx,cropped.width,cropped.height);
  S.procDataURL=cropped.toDataURL('image/jpeg',0.95);
  drawToMain(cropped);
  updOut(S.origFile.size,S.procDataURL,cropped.width+'Ã—'+cropped.height);
  S.cropperInst.destroy(); S.cropperInst=null;
  document.getElementById('cropArea').style.display='none';
  document.getElementById('applyCropBtn').style.display='none';
  showAct(); showAlert(`âœ… Cropped to ${cropped.width}Ã—${cropped.height}px!`,'ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: ROTATE & FLIP â•â•â•â•â•â•â•â•â•â•â•â• */
function quickRot(deg) {
  document.getElementById('rotRange').value=deg;
  document.getElementById('rotV').textContent=deg+'Â°';
  doRotate();
}

function doFlip(dir) {
  if(!needImg()) return;
  const img=S.origImg;
  const c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
  ctx.save();
  if(dir==='h'){ctx.translate(img.width,0);ctx.scale(-1,1);}
  else if(dir==='v'){ctx.translate(0,img.height);ctx.scale(1,-1);}
  else{ctx.translate(img.width,img.height);ctx.scale(-1,-1);}
  ctx.drawImage(img,0,0);
  ctx.restore();
  if(document.getElementById('rotBrand').checked) addBrand(ctx,c.width,c.height);
  S.procDataURL=c.toDataURL('image/jpeg',0.95);
  S.lastFn=doRotate;
  drawToMain(c); updOut(S.origFile.size,S.procDataURL);
  showAct(); showAlert(`âœ… Flipped ${dir==='h'?'horizontally':dir==='v'?'vertically':'both ways'}!`,'ok');
}

function doRotate() {
  if(!needImg()) return;
  S.lastFn=doRotate;
  const angle=parseInt(document.getElementById('rotRange').value)*Math.PI/180;
  const fill=document.getElementById('rotFill').checked;
  const brand=document.getElementById('rotBrand').checked;
  const img=S.origImg;
  const cos=Math.abs(Math.cos(angle)), sin=Math.abs(Math.sin(angle));
  const nw=Math.round(img.width*cos+img.height*sin);
  const nh=Math.round(img.width*sin+img.height*cos);
  const c=mkCanvas(nw,nh), ctx=c.getContext('2d');
  if(fill){ctx.fillStyle='#fff';ctx.fillRect(0,0,nw,nh);}
  ctx.translate(nw/2,nh/2); ctx.rotate(angle);
  ctx.drawImage(img,-img.width/2,-img.height/2);
  ctx.setTransform(1,0,0,1,0,0);
  if(brand) addBrand(ctx,nw,nh);
  S.procDataURL=c.toDataURL('image/jpeg',0.95);
  drawToMain(c); updOut(S.origFile.size,S.procDataURL,nw+'Ã—'+nh);
  showAct(); showAlert(`âœ… Rotated ${document.getElementById('rotRange').value}Â°!`,'ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: BACKGROUND â•â•â•â•â•â•â•â•â•â•â•â• */
function doBackground() {
  if(!needImg()) return;
  S.lastFn=doBackground;
  const fx=getTag('bgFx'), brand=document.getElementById('bgBrand').checked;
  const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
  showProg();
  setTimeout(()=>{
    if(fx==='Transparent'){
      ctx.drawImage(img,0,0);
      const tol=parseInt(document.getElementById('bgTol').value);
      const id=ctx.getImageData(0,0,c.width,c.height), d=id.data;
      for(let i=0;i<d.length;i+=4){ if(d[i]>255-tol&&d[i+1]>255-tol&&d[i+2]>255-tol) d[i+3]=0; }
      ctx.putImageData(id,0,0);
      S.procDataURL=c.toDataURL('image/png');
    } else if(fx==='Color Fill'){
      ctx.fillStyle=document.getElementById('bgC1').value; ctx.fillRect(0,0,c.width,c.height);
      ctx.drawImage(img,0,0);
      if(brand) addBrand(ctx,c.width,c.height);
      S.procDataURL=c.toDataURL('image/jpeg',0.93);
    } else if(fx==='Gradient'){
      const g=ctx.createLinearGradient(0,0,c.width,c.height);
      g.addColorStop(0,document.getElementById('bgC1').value);
      g.addColorStop(1,document.getElementById('bgC2').value);
      ctx.fillStyle=g; ctx.fillRect(0,0,c.width,c.height);
      ctx.drawImage(img,0,0);
      if(brand) addBrand(ctx,c.width,c.height);
      S.procDataURL=c.toDataURL('image/jpeg',0.93);
    } else if(fx==='Blur Effect'){
      ctx.filter=`blur(${document.getElementById('bgBlur').value}px)`;
      ctx.drawImage(img,0,0); ctx.filter='none';
      if(brand) addBrand(ctx,c.width,c.height);
      S.procDataURL=c.toDataURL('image/jpeg',0.93);
    }
    hideProg(); drawToMain(c); updOut(S.origFile.size,S.procDataURL);
    showAct(); showAlert(`âœ… "${fx}" applied!`,'ok');
  },200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: WATERMARK â•â•â•â•â•â•â•â•â•â•â•â• */
function setWmPos(el, pos) {
  document.querySelectorAll('.wmcell').forEach(c=>c.classList.remove('on'));
  el.classList.add('on'); S.wmPos=pos;
}

function getWmXY(cw,ch,tw,th) {
  const p=30;
  return {
    'top-left'   :{x:p+tw/2,    y:p+th/2},
    'top-center' :{x:cw/2,      y:p+th/2},
    'top-right'  :{x:cw-p-tw/2, y:p+th/2},
    'mid-left'   :{x:p+tw/2,    y:ch/2},
    'center'     :{x:cw/2,      y:ch/2},
    'mid-right'  :{x:cw-p-tw/2, y:ch/2},
    'bot-left'   :{x:p+tw/2,    y:ch-p-th/2},
    'bot-center' :{x:cw/2,      y:ch-p-th/2},
    'bot-right'  :{x:cw-p-tw/2, y:ch-p-th/2}
  }[S.wmPos]||{x:cw/2,y:ch/2};
}

function doWatermark() {
  if(!needImg()) return;
  S.lastFn=doWatermark;
  const isLogo=document.querySelector('#wmTabs .tabBtn.on')?.textContent?.includes('Logo');
  const img=S.origImg, c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
  ctx.drawImage(img,0,0);
  const op=parseInt(document.getElementById('wmOp').value)/100;
  const tiled=document.getElementById('wmTile').checked;
  const rotateTile=document.getElementById('wmRot').checked;
  ctx.globalAlpha=op;

  if(isLogo) {
    const lf=document.getElementById('wmLogoFile');
    if(!lf.files[0]){showAlert('Please select a logo image file.','err');return;}
    const reader=new FileReader();
    reader.onload=ev=>{
      const logo=new Image();
      logo.onload=()=>{
        const pct=parseInt(document.getElementById('wmLs').value)/100;
        const lw=c.width*pct, lh=lw*(logo.height/logo.width);
        ctx.globalAlpha=op;
        if(tiled){
          for(let y=0;y<c.height;y+=lh*2) for(let x=0;x<c.width;x+=lw*2) ctx.drawImage(logo,x,y,lw,lh);
        } else {
          const pos=getWmXY(c.width,c.height,lw,lh);
          ctx.drawImage(logo,pos.x-lw/2,pos.y-lh/2,lw,lh);
        }
        ctx.globalAlpha=1;
        S.procDataURL=c.toDataURL('image/jpeg',0.93);
        drawToMain(c); updOut(S.origFile.size,S.procDataURL);
        showAct(); showAlert('âœ… Logo watermark applied!','ok');
      };
      logo.src=ev.target.result;
    };
    reader.readAsDataURL(lf.files[0]);
    return;
  }

  // Text watermark
  const txt=document.getElementById('wmTxt').value||'Â© K Spider AI Tools';
  const fs=parseInt(document.getElementById('wmFs').value);
  const clr=document.getElementById('wmClr').value;
  ctx.font=`bold ${fs}px Rajdhani,sans-serif`;
  ctx.fillStyle=clr; ctx.textBaseline='middle';
  if(document.getElementById('wmShadow').checked){ctx.shadowColor='rgba(0,0,0,0.65)';ctx.shadowBlur=6;}

  if(tiled){
    const tw2=ctx.measureText(txt).width;
    ctx.globalAlpha=op*0.42;
    for(let y=fs*2;y<c.height;y+=fs*4){
      for(let x=0;x<c.width;x+=tw2+80){
        ctx.save(); ctx.translate(x,y);
        if(rotateTile) ctx.rotate(-Math.PI/6);
        ctx.fillText(txt,0,0); ctx.restore();
      }
    }
  } else {
    const tw2=ctx.measureText(txt).width;
    const pos=getWmXY(c.width,c.height,tw2,fs);
    ctx.fillText(txt,pos.x-tw2/2,pos.y);
  }
  ctx.globalAlpha=1; ctx.shadowBlur=0;
  S.procDataURL=c.toDataURL('image/jpeg',0.93);
  drawToMain(c); updOut(S.origFile.size,S.procDataURL);
  showAct(); showAlert('âœ… Text watermark applied!','ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODULE: BATCH â•â•â•â•â•â•â•â•â•â•â•â• */
function loadBatch(files) {
  S.batchFiles=Array.from(files).filter(f=>validateFile(f));
  S.batchResults=[];
  if(!S.batchFiles.length){showAlert('No valid images found.','err');return;}
  go('batch');
  document.getElementById('dropZone').style.display='none';
  document.getElementById('previewArea').style.display='block';
  document.getElementById('cvWrap').style.display='none';
  document.getElementById('infobar').style.display='none';
  document.getElementById('aiBox').style.display='none';
  const list=document.getElementById('batchList');
  list.innerHTML='';
  S.batchFiles.forEach((f,i)=>{
    const r=new FileReader(); r.onload=ev=>{
      const d=document.createElement('div'); d.className='bi'; d.id=`bi${i}`;
      d.innerHTML=`<img src="${ev.target.result}" alt=""><div class="bi-name">${f.name}</div><div class="bi-sz">${fmtBytes(f.size)}</div><div class="bi-st pend" id="bs${i}">â³</div>`;
      list.appendChild(d);
    }; r.readAsDataURL(f);
  });
  document.getElementById('batchActs').style.display='block';
  document.getElementById('dlBtn').style.display='flex';
  document.getElementById('waBtn').style.display='flex';
  document.getElementById('resetBtn').style.display='flex';
  showAlert(`ğŸ“‚ ${S.batchFiles.length} images loaded. Select operation and click Process All.`,'info');
}

async function doBatch() {
  if(!S.batchFiles.length){showAlert('Upload images first.','err');return;}
  const op=document.getElementById('batchOp').value;
  const brand=document.getElementById('batchBrand').checked;
  S.batchResults=[];
  for(let i=0;i<S.batchFiles.length;i++){
    const res=await procBatchFile(S.batchFiles[i],op,brand);
    S.batchResults.push({name:S.batchFiles[i].name,dataURL:res});
    const st=document.getElementById(`bs${i}`);
    if(st){st.textContent='âœ…';st.className='bi-st ok';}
  }
  showAlert(`âœ… All ${S.batchFiles.length} images processed! Click Download ZIP.`,'ok');
}

function procBatchFile(file,op,brand) {
  return new Promise(res=>{
    const r=new FileReader(); r.onload=ev=>{
      const img=new Image(); img.onload=()=>{
        const c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
        ctx.drawImage(img,0,0);
        if(op==='grayscale'||op==='sepia'||op==='invert') applyColor(ctx,c,op==='grayscale'?'Grayscale':op==='sepia'?'Sepia Tone':'Invert Colors');
        if(op==='resize50'){const c2=mkCanvas(Math.round(img.width/2),Math.round(img.height/2));c2.getContext('2d').drawImage(img,0,0,c2.width,c2.height);if(brand)addBrand(c2.getContext('2d'),c2.width,c2.height);res(c2.toDataURL('image/jpeg',0.85));return;}
        if(op==='resize25'){const c2=mkCanvas(Math.round(img.width/4),Math.round(img.height/4));c2.getContext('2d').drawImage(img,0,0,c2.width,c2.height);if(brand)addBrand(c2.getContext('2d'),c2.width,c2.height);res(c2.toDataURL('image/jpeg',0.85));return;}
        if(brand) addBrand(ctx,c.width,c.height);
        let mime='image/jpeg',q=0.8;
        if(op==='compress60') q=0.6;
        if(op==='toPng'){mime='image/png';q=1;}
        if(op==='toWebp'){mime='image/webp';q=0.85;}
        res(c.toDataURL(mime,q));
      }; img.src=ev.target.result;
    }; r.readAsDataURL(file);
  });
}

async function batchZip() {
  if(!S.batchResults.length){showAlert('Process images first.','err');return;}
  const op=document.getElementById('batchOp').value;
  let ext='jpg';
  if(op==='toPng') ext='png';
  if(op==='toWebp') ext='webp';
  const zip=new JSZip();
  S.batchResults.forEach(r=>{
    const base64=r.dataURL.split(',')[1];
    zip.file(r.name.replace(/\.[^.]+$/,`_kspider.${ext}`),base64,{base64:true});
  });
  const blob=await zip.generateAsync({type:'blob'});
  const url=URL.createObjectURL(blob);
  dlData(url,'kspider_batch.zip');
  URL.revokeObjectURL(url);
  showAlert('ğŸ“¦ ZIP downloaded!','ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• CAMERA â•â•â•â•â•â•â•â•â•â•â•â• */
async function openCamera() {
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:true});
    S.camStream=stream;
    document.getElementById('camVid').srcObject=stream;
    document.getElementById('camModal').classList.add('open');
  }catch{showAlert('Camera not available or access denied.','err');}
}
function capturePhoto() {
  const v=document.getElementById('camVid'), c=document.getElementById('capCanvas');
  c.width=v.videoWidth; c.height=v.videoHeight;
  c.getContext('2d').drawImage(v,0,0);
  closeModal('camModal');
  c.toBlob(b=>loadFile(new File([b],'camera.jpg',{type:'image/jpeg'})),'image/jpeg',0.95);
}
function closeCamera() {
  if(S.camStream){S.camStream.getTracks().forEach(t=>t.stop());S.camStream=null;}
}

/* â•â•â•â•â•â•â•â•â•â•â•â• URL PASTE â•â•â•â•â•â•â•â•â•â•â•â• */
function pasteUrl() {
  const url=prompt('ğŸ”— Paste image URL (CORS-accessible):');
  if(!url||!/^https?:\/\//i.test(url)){if(url)showAlert('Enter a valid http/https URL.','err');return;}
  const img=new Image(); img.crossOrigin='anonymous';
  img.onload=()=>{
    const c=mkCanvas(img.width,img.height); c.getContext('2d').drawImage(img,0,0);
    c.toBlob(b=>loadFile(new File([b],'url_image.jpg',{type:'image/jpeg'})),'image/jpeg',0.96);
  };
  img.onerror=()=>showAlert('Cannot load URL. Server may block cross-origin requests.','err');
  img.src=url;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• DOWNLOAD MODAL â•â•â•â•â•â•â•â•â•â•â•â• */
function openDlModal() {
  if(!S.procDataURL&&!S.origDataURL){showAlert('No image loaded yet.','err');return;}
  calcDlEst();
  document.getElementById('dlModal').classList.add('open');
}
function setQuality(el,q) {
  document.querySelectorAll('.qo').forEach(o=>o.classList.remove('on'));
  el.classList.add('on'); S.dlQuality=q; calcDlEst();
}
function calcDlEst() {
  const fmt=getTag('dlFmtTags');
  const data=S.procDataURL||S.origDataURL;
  if(!data||!S.origImg) return;
  const img=S.origImg, c=mkCanvas(img.width,img.height);
  c.getContext('2d').drawImage(img,0,0);
  let mime='image/jpeg';
  if(fmt==='PNG') mime='image/png';
  if(fmt==='WEBP') mime='image/webp';
  const est=c.toDataURL(mime,S.dlQuality);
  document.getElementById('dlEst').textContent=fmtBytes(Math.round(est.length*3/4));
}
function execDownload() {
  const fmt=getTag('dlFmtTags');
  const name=sanitize(document.getElementById('dlName').value)||'kspider_output';
  const data=S.procDataURL||S.origDataURL;
  if(!data){showAlert('No image to download.','err');return;}
  if(fmt==='PDF'){dlAsPdf(name);closeModal('dlModal');return;}
  const img=new Image(); img.onload=()=>{
    const c=mkCanvas(img.width,img.height), ctx=c.getContext('2d');
    ctx.drawImage(img,0,0);
    let mime='image/jpeg',ext='jpg';
    if(fmt==='PNG'){mime='image/png';ext='png';}
    if(fmt==='WEBP'){mime='image/webp';ext='webp';}
    const out=c.toDataURL(mime,S.dlQuality);
    dlData(out,`${name}.${ext}`);
    closeModal('dlModal');
    showAlert(`âœ… Downloaded as ${fmt} â€” ${fmtBytes(Math.round(out.length*3/4))}`,'ok');
  }; img.src=data;
}
function dlAsPdf(name) {
  const data=S.procDataURL||S.origDataURL;
  const img=new Image(); img.onload=()=>{
    const {jsPDF}=window.jspdf;
    const pdf=new jsPDF({orientation:img.width>img.height?'l':'p',unit:'px',format:[img.width,img.height]});
    pdf.addImage(data,'JPEG',0,0,img.width,img.height);
    pdf.save(`${name}.pdf`);
  }; img.src=data;
}
function dlData(dataURL,filename) {
  const a=document.createElement('a'); a.href=dataURL; a.download=filename;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• WHATSAPP â•â•â•â•â•â•â•â•â•â•â•â• */
function openWaModal() {
  document.getElementById('waName').value=S.userName;
  buildWaMsg();
  document.getElementById('waModal').classList.add('open');
}
function buildWaMsg() {
  const name=sanitize(document.getElementById('waName')?.value||S.userName||'User');
  const tool=S.currModule.charAt(0).toUpperCase()+S.currModule.slice(1);
  const msg=`ğŸ‘‹ Hello!\n\nI am *${name}*.\n\nI processed an image using *K Spider Image Master Pro* (${tool} tool).\n\nğŸ”— Try this FREE tool:\nğŸŒ www.kspiderai.in\nâ–¶ï¸ ${encodeURI('https://www.youtube.com/@KSpider4Kreaction')}\n\nâ€” ${BRAND}`;
  const el=document.getElementById('waPreview');
  if(el) el.textContent=`ğŸ‘‹ Hello!\n\nI am ${name}.\n\nI processed an image using K Spider Image Master Pro (${tool} tool).\n\nğŸ”— www.kspiderai.in\n\nâ€” ${BRAND}`;
}
function openWhatsApp() {
  const cc=document.getElementById('waCc').value.replace(/\D/g,'');
  const ph=document.getElementById('waPhone').value.replace(/\D/g,'');
  if(!ph||ph.length<7){showAlert('Please enter a valid phone number.','err');return;}
  const name=sanitize(document.getElementById('waName').value||S.userName||'User');
  const tool=S.currModule.charAt(0).toUpperCase()+S.currModule.slice(1);
  const msg=`ğŸ‘‹ Hello!\n\nI am ${name}.\n\nI processed an image using K Spider Image Master Pro (${tool} tool).\n\nTry this FREE image tool:\nğŸŒ www.kspiderai.in\nâ–¶ https://www.youtube.com/@KSpider4Kreaction\n\n${BRAND}`;
  window.open(`https://wa.me/${cc}${ph}?text=${encodeURIComponent(msg)}`,'_blank','noopener,noreferrer');
  closeModal('waModal');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• REGENERATE & EDIT AGAIN â•â•â•â•â•â•â•â•â•â•â•â• */
function regen() { if(S.lastFn) S.lastFn(); else showAlert('No previous action to regenerate.','info'); }
function editAgain() {
  S.procDataURL=null; renderOrig();
  document.getElementById('outBox').style.display='none';
  document.getElementById('actRow').style.display='none';
  hideAlert(); showAlert('âœï¸ Original restored. Adjust settings and process again.','info');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MONETIZE â•â•â•â•â•â•â•â•â•â•â•â• */
function copyUpi() { navigator.clipboard?.writeText('kspider221206@gmail.com'); showAlert('âœ… UPI ID copied!','ok'); }
function copyLink() { navigator.clipboard?.writeText('https://www.kspiderai.in'); showAlert('âœ… Link copied!','ok'); }
function shareWA()      { window.open(`https://wa.me/?text=${encodeURIComponent('Check out this free image tool! '+BRAND+' https://www.kspiderai.in')}`) }
function shareFB()      { window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.kspiderai.in')}`) }
function shareTwitter() { window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent('Free browser image tool â€“ K Spider Image Master Pro!\n'+BRAND+'\nhttps://www.kspiderai.in')}`) }
function shareLI()      { window.open(`https://www.linkedin.com/shareArticle?url=${encodeURIComponent('https://www.kspiderai.in')}&title=${encodeURIComponent('K Spider Image Master Pro')}`) }

function rateTool(n) {
  document.querySelectorAll('.star').forEach((s,i)=>{ s.classList.toggle('lit',i<n); });
  const msgs=['','Thanks!','Appreciate it!','Nice, thank you!','Great, love it!','Amazing! You are awesome! ğŸ™'];
  document.getElementById('rateMsg').textContent=msgs[n]||'Thanks!';
}

/* â•â•â•â•â•â•â•â•â•â•â•â• COLLAPSIBLE â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleCol(hdr) {
  const body=hdr.nextElementSibling, arr=hdr.querySelector('.col-arr');
  const open=body.classList.toggle('open');
  arr.style.transform=open?'rotate(180deg)':'rotate(0)';
}

/* â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â• */
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.addEventListener('click',e=>{ if(e.target.classList.contains('modal')) e.target.classList.remove('open'); });
document.addEventListener('keydown',e=>{ if(e.key==='Escape') document.querySelectorAll('.modal.open').forEach(m=>m.classList.remove('open')); });
document.getElementById('camModal').addEventListener('click',e=>{
  if(e.target===document.getElementById('camModal')){ closeCamera(); closeModal('camModal'); }
});

/* â•â•â•â•â•â•â•â•â•â•â•â• TAB HELPERS â•â•â•â•â•â•â•â•â•â•â•â• */
function setTab(el, groupId) {
  const parent = el.closest('.tabs');
  parent?.querySelectorAll('.tabBtn').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');
}

/* â•â•â•â•â•â•â•â•â•â•â•â• TAG HELPER â•â•â•â•â•â•â•â•â•â•â•â• */
function setTag(el, groupId) {
  document.querySelectorAll(`#${groupId} .tag`).forEach(t=>t.classList.remove('on'));
  el.classList.add('on');
}
function getTag(groupId) {
  const a=document.querySelector(`#${groupId} .tag.on`);
  return a?a.textContent.trim():null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• SHOW/HIDE â•â•â•â•â•â•â•â•â•â•â•â• */
function showEl(id){document.getElementById(id).style.display='block';}
function hideEl(id){document.getElementById(id).style.display='none';}

/* â•â•â•â•â•â•â•â•â•â•â•â• CANVAS HELPERS â•â•â•â•â•â•â•â•â•â•â•â• */
function mkCanvas(w,h){const c=document.createElement('canvas');c.width=w;c.height=h;return c;}
function drawToMain(srcC) {
  const c=document.getElementById('mainCanvas');
  const mW=820,mH=420; let w=srcC.width,h=srcC.height;
  if(w>mW){h=Math.round(h*mW/w);w=mW;}
  if(h>mH){w=Math.round(w*mH/h);h=mH;}
  c.width=w;c.height=h;
  c.getContext('2d').drawImage(srcC,0,0,w,h);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• OUTPUT BOX â•â•â•â•â•â•â•â•â•â•â•â• */
function updOut(origBytes, dataURL, dims) {
  const box=document.getElementById('outBox'); box.style.display='block';
  const nb=Math.round(dataURL.length*3/4);
  document.getElementById('origSz').textContent=fmtBytes(origBytes);
  document.getElementById('newSz').textContent=fmtBytes(nb);
  if(dims) document.getElementById('newDims').textContent=dims;
  const pct=Math.round((1-nb/origBytes)*100);
  const tag=document.getElementById('szTag');
  if(pct>0){tag.textContent='â†“ '+pct+'% smaller';tag.className='sz-tag sz-down';}
  else if(pct<0){tag.textContent='â†‘ '+Math.abs(pct)+'% larger';tag.className='sz-tag sz-up';}
  else{tag.textContent='â‰ˆ same';tag.className='sz-tag';}
}

/* â•â•â•â•â•â•â•â•â•â•â•â• ACTION ROW â•â•â•â•â•â•â•â•â•â•â•â• */
function showAct() { document.getElementById('actRow').style.display='flex'; }

/* â•â•â•â•â•â•â•â•â•â•â•â• PROGRESS â•â•â•â•â•â•â•â•â•â•â•â• */
let _pint=null;
function showProg() {
  document.getElementById('outBox').style.display='block';
  document.getElementById('pgBar').style.display='block';
  document.getElementById('pgFill').style.width='0%';
  let w=0;
  _pint=setInterval(()=>{ w=Math.min(w+14,88); document.getElementById('pgFill').style.width=w+'%'; if(w>=88)clearInterval(_pint); },45);
}
function hideProg() {
  clearInterval(_pint);
  document.getElementById('pgFill').style.width='100%';
  setTimeout(()=>{ document.getElementById('pgBar').style.display='none'; document.getElementById('pgFill').style.width='0%'; },350);
}

/* â•â•â•â•â•â•â•â•â•â•â•â• ALERT â•â•â•â•â•â•â•â•â•â•â•â• */
let _atimer=null;
function showAlert(msg,type) {
  const el=document.getElementById('alert');
  el.textContent=msg;
  el.className=`alert alert-${type==='ok'?'ok':type==='err'?'err':'info'} show`;
  clearTimeout(_atimer); _atimer=setTimeout(()=>el.classList.remove('show'),6000);
}
function hideAlert(){document.getElementById('alert').className='alert';}

/* â•â•â•â•â•â•â•â•â•â•â•â• GUARD â•â•â•â•â•â•â•â•â•â•â•â• */
function needImg() {
  if(!S.origImg){showAlert('âš  Please upload an image first.','err');document.getElementById('dropZone').scrollIntoView({behavior:'smooth'});return false;}
  return true;
}

/* â•â•â•â•â•â•â•â•â•â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â• */
function fmtBytes(b){if(!b||b<0)return'0 B';if(b<1024)return b+' B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(2)+' MB';}
function sanitize(s){return(s||'').replace(/<[^>]*>/g,'').replace(/[<>"'`]/g,'').trim().substring(0,200);}
</script>
</body>
</html>
